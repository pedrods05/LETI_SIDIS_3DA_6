_format_version: "3.0"
_transform: true

services:
  # Patients Service (both paths)
  - name: patients-service
    host: patients-upstream
    port: 80
    protocol: http
    routes:
      - name: patients-route
        paths:
          - /patients
          - /api/v2/patients
        strip_path: false

  # Physicians Service
  - name: physicians-service
    host: physicians-upstream
    port: 80
    protocol: http
    routes:
      - name: physicians-route
        paths:
          - /physicians
          - /appointments
        strip_path: false

  # Appointment Records Service (mirror path externally)
  - name: records-service
    host: records-upstream
    port: 80
    protocol: http
    routes:
      - name: records-route
        paths:
          - /api/appointment-records
        strip_path: false

  # Auth Service (mirror external path)
  - name: auth-service
    host: auth-upstream
    port: 80
    protocol: http
    routes:
      - name: auth-route-mirror
        paths:
          - /api/public
        strip_path: false

  # Auth Service (short external path -> upstream /api/public)
  - name: auth-service-short
    host: auth-upstream
    port: 80
    protocol: http
    path: /api/public
    routes:
      - name: auth-route-short
        paths:
          - /auth
        strip_path: true

upstreams:
  - name: patients-upstream
    targets:
      - target: host.docker.internal:8082
        weight: 100
      - target: host.docker.internal:8088
        weight: 100

  - name: physicians-upstream
    targets:
      - target: host.docker.internal:8081
        weight: 100
      - target: host.docker.internal:8087
        weight: 100

  - name: records-upstream
    targets:
      - target: host.docker.internal:8083
        weight: 100
      - target: host.docker.internal:8090
        weight: 100

  - name: auth-upstream
    targets:
      - target: host.docker.internal:8084
        weight: 100
      - target: host.docker.internal:8089
        weight: 100

spring.application.name=hap-patients

# --- 1. REMOVIDO: O perfil deve ser definido na Run Config do IntelliJ, não aqui ---
# spring.profiles.active=instance1

# --- DOCS (OpenAPI) ---
springdoc.api-docs.enabled=true
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method
springdoc.swagger-ui.tagsSorter=alpha
springdoc.swagger-ui.tryItOutEnabled=true
springdoc.swagger-ui.filter=true
springdoc.swagger-ui.disable-swagger-default-url=false
springdoc.swagger-ui.url=/v3/api-docs
springdoc.default-consumes-media-type=application/json
springdoc.default-produces-media-type=application/json
springdoc.paths-to-match=/api/**,/patients/**

# --- SERVER ---
# A porta por defeito é 8082, mas os perfis (instance1/2) podem sobrepor isto
server.port=8082

# --- RABBITMQ ---
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
hap.rabbitmq.exchange=hap-exchange

# --- DATA (MongoDB) ---
# MANTÉM COMENTADO! Isto obriga a usar os ficheiros instance1/instance2
# spring.data.mongodb.uri=mongodb://root:secretpassword@localhost:27017/happatients_db?authSource=admin

# --- REMOTE SERVICES ---
hap.auth.base-url=https://localhost:8084
hap.physicians.base-url=https://localhost:8081
hap.appointmentrecords.base-url=https://localhost:8083

# --- DATA (H2 - Write Model) ---
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.datasource.driverClassName=org.h2.Driver
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=update
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.h2.console.settings.web-allow-others=true

# Desligar logs de SQL para ficar mais limpo
spring.jpa.show-sql=false

# --- FILE UPLOAD ---
spring.servlet.multipart.enabled=true
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=215MB
file.upload-dir=uploads/

# ======================================================
#  LOGGING (A Mágica para ficar bonito ?)
# ======================================================

# 1. O teu código (mostra os emojis ? ?)
logging.level.leti_sisdis_6=INFO

# 2. Desligar o ruído do Spring Security (estava em DEBUG)
logging.level.root=INFO
logging.level.org.springframework=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.security.oauth2=INFO
logging.level.org.apache.catalina=INFO
logging.level.org.apache.tomcat=INFO

# ======================================================

# --- OBSERVABILITY ---
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true
info.app.name=${spring.application.name}
info.app.description=Microserviço HAP com CQRS e Eventos
info.app.version=1.0.0

# --- RESILIENCE4J ---
resilience4j.circuitbreaker.instances.authService.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.authService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.authService.minimumNumberOfCalls=5
resilience4j.circuitbreaker.instances.authService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.authService.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.authService.waitDurationInOpenState=5s
resilience4j.circuitbreaker.instances.authService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.authService.eventConsumerBufferSize=10

# --- TRACING (Zipkin) ---
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://localhost:9411/api/v2/spans

server.ssl.enabled=true
server.ssl.key-store-type=PKCS12
server.ssl.key-store=classpath:certs/hap-keystore.p12
server.ssl.key-store-password=secretpassword
server.ssl.key-alias=hap-service

# Forçar mTLS (O cliente TEM de apresentar certificado)
server.ssl.client-auth=need
server.ssl.trust-store-type=PKCS12
server.ssl.trust-store=classpath:certs/hap-truststore.p12
server.ssl.trust-store-password=secretpassword
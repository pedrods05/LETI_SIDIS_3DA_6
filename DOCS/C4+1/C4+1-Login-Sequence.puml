@startuml
' C4+1 â€” Login SD (layered)
skinparam dpi 150
skinparam shadowing false
skinparam DefaultFontName Arial

title C4: Sequence Diagram - Login (Public)

actor User
participant "AuthController" as Controller
participant "AuthService" as Service
participant "UserRepository" as Repo

User -> Controller : POST /api/public/login { username, password }
activate Controller
alt Wrong Port
  Controller --> User : 400 Bad Request
  deactivate Controller
else Valid payload
  Controller -> Service : login(credentials)
  activate Service
  Service -> Repo : findByUsername(username)
  activate Repo
  alt User found
    Repo --> Service : User Entity (+passwordHash)
    deactivate Repo
    Service -> Service : verifyPassword()
    alt Credentials valid
      Service --> Controller : Token { jwt }
      deactivate Service
      Controller --> User : 200 OK { token }
      deactivate Controller
    else Invalid credentials
      Service --> Controller : Invalid Credentials
      deactivate Service
      Controller --> User : 401 Invalid Credentials
      deactivate Controller
    end
  else User not found
   Service --> Controller : Invalid Credentials
    deactivate Service
    Controller --> User : 401 Invalid Credentials
    deactivate Controller
  end
end

@enduml

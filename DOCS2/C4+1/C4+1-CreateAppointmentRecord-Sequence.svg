<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="2081.25px" preserveAspectRatio="none" style="width:3292px;height:2081px;background:#FFFFFF;" version="1.1" viewBox="0 0 3292 2081" width="3292.1875px" zoomAndPan="magnify"><title>C4: Sequence Diagram - Create Appointment Record</title><defs/><g><text fill="#000000" font-family="Arial" font-size="21.875" font-weight="bold" lengthAdjust="spacing" textLength="548.1995" x="1371.0121" y="43.2404">C4: Sequence Diagram - Create Appointment Record</text><g><title>Physician Client</title><rect fill="#FFFFFF" height="1743.0908" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="105.9372" y="198.877"/></g><g><title>Spring Security</title><rect fill="#FFFFFF" height="81.3232" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="436.4594" y="298.2056"/></g><g><title>AppointmentRecordController</title><rect fill="#FFFFFF" height="215.4785" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="828.1494" y="253.6377"/></g><g><title>AppointmentRecordService</title><rect fill="#FFFFFF" height="834.668" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="1495.0775" y="569.1895"/></g><g><title>hap-physicians API .external.</title><rect fill="#FFFFFF" height="81.3232" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="2234.1873" y="636.4502"/></g><rect fill="none" height="204.541" style="stroke:#000000;stroke-width:2.3438;" width="990.9828" x="15.625" y="321.6431"/><rect fill="none" height="202.1606" style="stroke:#000000;stroke-width:2.3438;" width="1068.2358" x="1343.187" y="659.8877"/><rect fill="none" height="583.4961" style="stroke:#000000;stroke-width:2.3438;" width="1646.9681" x="15.625" y="1345.9717"/><g><title>Physician Client</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="107.4997" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="112.5" x2="112.5" y1="183.252" y2="1956.0303"/></g><g><title>Spring Security</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="438.0219" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="443.5448" x2="443.5448" y1="183.252" y2="1956.0303"/></g><g><title>AppointmentRecordController</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="829.7119" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="835.6285" x2="835.6285" y1="183.252" y2="1956.0303"/></g><g><title>AppointmentRecordService</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="1496.64" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="1502.562" x2="1502.562" y1="183.252" y2="1956.0303"/></g><g><title>hap-physicians API .external.</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="2235.7498" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="2241.3269" x2="2241.3269" y1="183.252" y2="1956.0303"/></g><g><title>MongoDB .Write Model.</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="2533.416" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="2539.5477" x2="2539.5477" y1="183.252" y2="1956.0303"/></g><g><title>MongoDB .Projection Read Model.</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="2857.8331" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="2863.2217" x2="2863.2217" y1="183.252" y2="1956.0303"/></g><g><title>RabbitMQ Exchange</title><rect fill="#000000" fill-opacity="0.00000" height="1772.7783" width="12.5" x="3165.8653" y="183.252"/><line style="stroke:#181818;stroke-width:0.7813;stroke-dasharray:7.8125,7.8125;" x1="3171.1945" x2="3171.1945" y1="183.252" y2="1956.0303"/></g><g class="participant participant-head" data-participant="C"><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="155.6244" x="31.25" y="178.6163">Physician Client</text><ellipse cx="113.7497" cy="78.3447" fill="#E2E2F0" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.7813;"/><path d="M113.7497,90.8447 L113.7497,133.0322 M93.4372,103.3447 L134.0622,103.3447 M113.7497,133.0322 L93.4372,156.4697 M113.7497,133.0322 L134.0622,156.4697" fill="none" style="stroke:#181818;stroke-width:0.7813;"/></g><g class="participant participant-tail" data-participant="C"><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="155.6244" x="31.25" y="1974.2706">Physician Client</text><ellipse cx="113.7497" cy="1992.1875" fill="#E2E2F0" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.7813;"/><path d="M113.7497,2004.6875 L113.7497,2046.875 M93.4372,2017.1875 L134.0622,2017.1875 M113.7497,2046.875 L93.4372,2070.3125 M113.7497,2046.875 L134.0622,2070.3125" fill="none" style="stroke:#181818;stroke-width:0.7813;"/></g><g class="participant participant-head" data-participant="SEC"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="170.2042" x="359.1698" y="135.376"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="148.3292" x="370.1073" y="166.1163">Spring Security</text></g><g class="participant participant-tail" data-participant="SEC"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="170.2042" x="359.1698" y="1954.4678"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="148.3292" x="370.1073" y="1985.2081">Spring Security</text></g><g class="participant participant-head" data-participant="ARC"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="310.0418" x="680.941" y="135.376"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="288.1668" x="691.8785" y="166.1163">AppointmentRecordController</text></g><g class="participant participant-tail" data-participant="ARC"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="310.0418" x="680.941" y="1954.4678"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="288.1668" x="691.8785" y="1985.2081">AppointmentRecordController</text></g><g class="participant participant-head" data-participant="ARS"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="288.1561" x="1358.812" y="135.376"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="266.2811" x="1369.7495" y="166.1163">AppointmentRecordService</text></g><g class="participant participant-tail" data-participant="ARS"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="288.1561" x="1358.812" y="1954.4678"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="266.2811" x="1369.7495" y="1985.2081">AppointmentRecordService</text></g><g class="participant participant-head" data-participant="HPHY"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="307.5958" x="2088.2019" y="135.376"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="285.7208" x="2099.1394" y="166.1163">hap-physicians API (external)</text></g><g class="participant participant-tail" data-participant="HPHY"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="307.5958" x="2088.2019" y="1954.4678"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="285.7208" x="2099.1394" y="1985.2081">hap-physicians API (external)</text></g><g class="participant participant-head" data-participant="MONGO_W"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="256.4865" x="2411.4227" y="135.376"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="234.6115" x="2422.3602" y="166.1163">MongoDB (Write Model)</text></g><g class="participant participant-tail" data-participant="MONGO_W"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="256.4865" x="2411.4227" y="1954.4678"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="234.6115" x="2422.3602" y="1985.2081">MongoDB (Write Model)</text></g><g class="participant participant-head" data-participant="MONGO_R"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="361.0977" x="2683.5342" y="135.376"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="339.2227" x="2694.4717" y="166.1163">MongoDB (Projection Read Model)</text></g><g class="participant participant-tail" data-participant="MONGO_R"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="361.0977" x="2683.5342" y="1954.4678"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="339.2227" x="2694.4717" y="1985.2081">MongoDB (Projection Read Model)</text></g><g class="participant participant-head" data-participant="RMQ"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="223.7167" x="3060.257" y="135.376"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="201.8417" x="3071.1945" y="166.1163">RabbitMQ Exchange</text></g><g class="participant participant-tail" data-participant="RMQ"><rect fill="#E2E2F0" height="46.3135" rx="3.9063" ry="3.9063" style="stroke:#181818;stroke-width:0.7813;" width="223.7167" x="3060.257" y="1954.4678"/><text fill="#000000" font-family="Arial" font-size="21.875" lengthAdjust="spacing" textLength="201.8417" x="3071.1945" y="1985.2081">RabbitMQ Exchange</text></g><g><title>Physician Client</title><rect fill="#FFFFFF" height="1743.0908" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="105.9372" y="198.877"/></g><g><title>Spring Security</title><rect fill="#FFFFFF" height="81.3232" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="436.4594" y="298.2056"/></g><g><title>AppointmentRecordController</title><rect fill="#FFFFFF" height="215.4785" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="828.1494" y="253.6377"/></g><g><title>AppointmentRecordService</title><rect fill="#FFFFFF" height="834.668" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="1495.0775" y="569.1895"/></g><g><title>hap-physicians API .external.</title><rect fill="#FFFFFF" height="81.3232" style="stroke:#181818;stroke-width:1.5625;" width="15.625" x="2234.1873" y="636.4502"/></g><g class="message" data-participant-1="C" data-participant-2="ARC"><polygon fill="#181818" points="809.3994,247.3877,825.0244,253.6377,809.3994,259.8877,815.6494,253.6377" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;" x1="121.5622" x2="818.7744" y1="253.6377" y2="253.6377"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="132.4997" y="234.8618">1</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="496.8033" x="150.0465" y="223.5153">POST /api/appointment-records/{appointmentId}/record</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="659.3529" x="150.0465" y="246.2082">Authorization, X-User-Id (physicianId), body: AppointmentRecordRequest</text></g><g class="message" data-participant-1="ARC" data-participant-2="SEC"><polygon fill="#181818" points="469.2719,291.9556,453.6469,298.2056,469.2719,304.4556,463.0219,298.2056" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;" x1="459.8969" x2="826.5869" y1="298.2056" y2="298.2056"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="478.6469" y="290.7761">2</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="260.6209" x="496.1937" y="290.7761">hasAuthority('PHYSICIAN') ?</text></g><path d="M15.625,321.6431 L109.642,321.6431 L109.642,331.8359 L94.017,347.4609 L15.625,347.4609 L15.625,321.6431" fill="#EEEEEE" style="stroke:#000000;stroke-width:2.3438;"/><rect fill="none" height="204.541" style="stroke:#000000;stroke-width:2.3438;" width="990.9828" x="15.625" y="321.6431"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="23.7045" x="39.0625" y="341.5939">alt</text><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="101.1948" x="133.0795" y="340.3275">[Authorized]</text><g class="message" data-participant-1="SEC" data-participant-2="ARC"><polygon fill="#181818" points="809.3994,373.2788,825.0244,379.5288,809.3994,385.7788,815.6494,379.5288" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="444.2719" x2="818.7744" y1="379.5288" y2="379.5288"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="455.2094" y="372.0993">3</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="46.2883" x="472.7562" y="372.0993">allow</text></g><line style="stroke:#000000;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="15.625" x2="1006.6078" y1="393.5913" y2="393.5913"/><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="131.7513" x="23.4375" y="409.1507">[Not authorized]</text><g class="message" data-participant-1="SEC" data-participant-2="C"><polygon fill="#181818" points="138.7497,462.8662,123.1247,469.1162,138.7497,475.3662,132.4997,469.1162" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="129.3747" x2="442.7094" y1="469.1162" y2="469.1162"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="148.1247" y="450.3403">4</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="267.6628" x="165.6715" y="438.9938">403 Forbidden + {"error": "..."}</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="151.2627" x="165.6715" y="461.6867">(Spring Security)</text></g><g class="message" data-participant-1="C" data-participant-2="SEC"><polygon fill="#181818" points="425.5219,507.4341,441.1469,513.6841,425.5219,519.9341,431.7719,513.6841" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="121.5622" x2="434.8969" y1="513.6841" y2="513.6841"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="132.4997" y="506.2546">5</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="5.6435" x="150.0465" y="506.2546">&#160;</text></g><g class="message" data-participant-1="ARC" data-participant-2="ARS"><polygon fill="#181818" points="1476.3275,562.9395,1491.9525,569.1895,1476.3275,575.4395,1482.5775,569.1895" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;" x1="835.9619" x2="1485.7025" y1="569.1895" y2="569.1895"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="846.8994" y="561.7599">6</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="456.1485" x="864.4463" y="561.7599">createRecord(appointmentId, request, physicianId)</text></g><g class="message" data-participant-1="ARS" data-participant-2="HPHY"><polygon fill="#181818" points="2215.4373,630.2002,2231.0623,636.4502,2215.4373,642.7002,2221.6873,636.4502" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="2224.8123" y1="636.4502" y2="636.4502"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="1521.64" y="617.6743">7</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="322.9469" x="1539.1869" y="606.3278">GET /appointments/{appointmentId}</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="218.4883" x="1539.1869" y="629.0207">(+ Authorization header)</text></g><path d="M1343.187,659.8877 L1437.204,659.8877 L1437.204,670.0806 L1421.579,685.7056 L1343.187,685.7056 L1343.187,659.8877" fill="#EEEEEE" style="stroke:#000000;stroke-width:2.3438;"/><rect fill="none" height="202.1606" style="stroke:#000000;stroke-width:2.3438;" width="1068.2358" x="1343.187" y="659.8877"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="23.7045" x="1366.6245" y="679.8386">alt</text><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="170.9267" x="1460.6415" y="678.5721">[Appointment exists]</text><g class="message" data-participant-1="HPHY" data-participant-2="ARS"><polygon fill="#181818" points="1527.89,711.5234,1512.265,717.7734,1527.89,724.0234,1521.64,717.7734" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="1518.515" x2="2240.4373" y1="717.7734" y2="717.7734"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="1537.265" y="710.3439">8</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="546.7316" x="1554.8119" y="710.3439">200 OK + { patientId, physicianId | physician: { physicianId } }</text></g><g class="message" data-participant-1="ARS" data-participant-2="ARS"><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="1576.3275" y1="762.3413" y2="762.3413"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1576.3275" x2="1576.3275" y1="762.3413" y2="782.6538"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1512.265" x2="1576.3275" y1="782.6538" y2="782.6538"/><polygon fill="#181818" points="1527.89,776.4038,1512.265,782.6538,1527.89,788.9038,1521.64,782.6538" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="11.2968" x="1521.64" y="754.9118">9</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="439.238" x="1539.1869" y="754.9118">normalize physicianId if nested under physician{}</text></g><line style="stroke:#000000;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="1343.187" x2="2411.4227" y1="796.7163" y2="796.7163"/><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="201.4076" x="1350.9995" y="812.2757">[Appointment not found]</text><g class="message" data-participant-1="HPHY" data-participant-2="ARS"><polygon fill="#181818" points="1527.89,843.2983,1512.265,849.5483,1527.89,855.7983,1521.64,849.5483" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="1518.515" x2="2240.4373" y1="849.5483" y2="849.5483"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1537.265" y="842.1188">10</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="134.3819" x="1566.1087" y="842.1188">404 Not Found</text></g><g class="message" data-participant-1="ARS" data-participant-2="ARS"><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="1576.3275" y1="905.0537" y2="905.0537"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1576.3275" x2="1576.3275" y1="905.0537" y2="925.3662"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1512.265" x2="1576.3275" y1="925.3662" y2="925.3662"/><polygon fill="#181818" points="1527.89,919.1162,1512.265,925.3662,1527.89,931.6162,1521.64,925.3662" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1521.64" y="897.6242">11</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="657.1411" x="1550.4837" y="897.6242">if appointmentPhysicianId != physicianId -&gt; throw UnauthorizedException</text></g><g class="message" data-participant-1="ARS" data-participant-2="ARS"><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="1576.3275" y1="969.9341" y2="969.9341"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1576.3275" x2="1576.3275" y1="969.9341" y2="990.2466"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1512.265" x2="1576.3275" y1="990.2466" y2="990.2466"/><polygon fill="#181818" points="1527.89,983.9966,1512.265,990.2466,1527.89,996.4966,1521.64,990.2466" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1521.64" y="962.5046">12</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="651.9936" x="1550.4837" y="962.5046">if record exists for appointmentId -&gt; throw IllegalStateException (conflict)</text></g><g class="message" data-participant-1="ARS" data-participant-2="ARS"><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="1576.3275" y1="1034.8145" y2="1034.8145"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1576.3275" x2="1576.3275" y1="1034.8145" y2="1055.127"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1512.265" x2="1576.3275" y1="1055.127" y2="1055.127"/><polygon fill="#181818" points="1527.89,1048.877,1512.265,1055.127,1527.89,1061.377,1521.64,1055.127" style="stroke:#181818;stroke-width:1.5625;"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1521.64" y="1027.3849">13</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="431.8588" x="1550.4837" y="1027.3849">if patientId missing -&gt; throw NotFoundException</text></g><g class="message" data-participant-1="ARS" data-participant-2="MONGO_W"><polygon fill="#181818" points="2520.916,1093.4448,2536.541,1099.6948,2520.916,1105.9448,2527.166,1099.6948" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="2530.291" y1="1099.6948" y2="1099.6948"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1521.64" y="1092.2653">14</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="581.4751" x="1550.4837" y="1092.2653">save AppointmentRecord(recordId, appointmentId, diagnosis, ...)</text></g><g class="message" data-participant-1="MONGO_W" data-participant-2="ARS"><polygon fill="#181818" points="1527.89,1138.0127,1512.265,1144.2627,1527.89,1150.5127,1521.64,1144.2627" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="1518.515" x2="2538.1035" y1="1144.2627" y2="1144.2627"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1537.265" y="1136.8332">15</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="31.6093" x="1566.1087" y="1136.8332">ack</text></g><g class="message" data-participant-1="ARS" data-participant-2="MONGO_R"><polygon fill="#181818" points="2845.3331,1182.5806,2860.9581,1188.8306,2845.3331,1195.0806,2851.5831,1188.8306" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="2854.7081" y1="1188.8306" y2="1188.8306"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1521.64" y="1181.4011">16</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="873.9235" x="1550.4837" y="1181.4011">save AppointmentRecordProjection(recordId, appointmentId, patientId, physicianId, diagnosis, ...)</text></g><g class="message" data-participant-1="MONGO_R" data-participant-2="ARS"><polygon fill="#181818" points="1527.89,1227.1484,1512.265,1233.3984,1527.89,1239.6484,1521.64,1233.3984" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="1518.515" x2="2862.5206" y1="1233.3984" y2="1233.3984"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1537.265" y="1225.9689">17</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="31.6093" x="1566.1087" y="1225.9689">ack</text></g><g class="message" data-participant-1="ARS" data-participant-2="RMQ"><polygon fill="#181818" points="3153.3653,1271.7163,3168.9903,1277.9663,3153.3653,1284.2163,3159.6153,1277.9663" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;" x1="1510.7025" x2="3162.7403" y1="1277.9663" y2="1277.9663"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1521.64" y="1270.5368">18</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="908.9149" x="1550.4837" y="1270.5368">publish AppointmentRecordCreatedEvent(recordId, appointmentId, patientId, physicianId, timestamp)</text></g><g class="message" data-participant-1="RMQ" data-participant-2="ARS"><polygon fill="#181818" points="1527.89,1316.2842,1512.265,1322.5342,1527.89,1328.7842,1521.64,1322.5342" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="1518.515" x2="3170.5528" y1="1322.5342" y2="1322.5342"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="1537.265" y="1315.1047">19</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="31.6093" x="1566.1087" y="1315.1047">ack</text></g><path d="M15.625,1345.9717 L109.642,1345.9717 L109.642,1356.1646 L94.017,1371.7896 L15.625,1371.7896 L15.625,1345.9717" fill="#EEEEEE" style="stroke:#000000;stroke-width:2.3438;"/><rect fill="none" height="583.4961" style="stroke:#000000;stroke-width:2.3438;" width="1646.9681" x="15.625" y="1345.9717"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="23.7045" x="39.0625" y="1365.9225">alt</text><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="183.4061" x="133.0795" y="1364.6561">[Created successfully]</text><g class="message" data-participant-1="ARS" data-participant-2="ARC"><polygon fill="#181818" points="853.1494,1397.6074,837.5244,1403.8574,853.1494,1410.1074,846.8994,1403.8574" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="843.7744" x2="1501.3275" y1="1403.8574" y2="1403.8574"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="862.5244" y="1396.4279">20</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="592.7719" x="891.3681" y="1396.4279">AppointmentRecordResponse(recordId, appointmentId, message)</text></g><g class="message" data-participant-1="ARC" data-participant-2="C"><polygon fill="#181818" points="138.7497,1442.1753,123.1247,1448.4253,138.7497,1454.6753,132.4997,1448.4253" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="129.3747" x2="834.3994" y1="1448.4253" y2="1448.4253"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="148.1247" y="1440.9958">21</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="405.9425" x="176.9684" y="1440.9958">201 Created + AppointmentRecordResponse</text></g><line style="stroke:#000000;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="15.625" x2="1662.5931" y1="1462.4878" y2="1462.4878"/><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="174.7116" x="23.4375" y="1478.0472">[NotFoundException]</text><g class="message" data-participant-1="ARS" data-participant-2="ARC"><polygon fill="#181818" points="853.1494,1509.0698,837.5244,1515.3198,853.1494,1521.5698,846.8994,1515.3198" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="843.7744" x2="1501.3275" y1="1515.3198" y2="1515.3198"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="862.5244" y="1507.8903">22</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="285.6247" x="891.3681" y="1507.8903">throw NotFoundException(msg)</text></g><g class="message" data-participant-1="ARC" data-participant-2="C"><polygon fill="#181818" points="138.7497,1553.6377,123.1247,1559.8877,138.7497,1566.1377,132.4997,1559.8877" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="129.3747" x2="834.3994" y1="1559.8877" y2="1559.8877"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="148.1247" y="1552.4582">23</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="278.067" x="176.9684" y="1552.4582">404 Not Found + {"error": msg}</text></g><line style="stroke:#000000;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="15.625" x2="1662.5931" y1="1573.9502" y2="1573.9502"/><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="203.3882" x="23.4375" y="1589.5096">[UnauthorizedException]</text><g class="message" data-participant-1="ARS" data-participant-2="ARC"><polygon fill="#181818" points="853.1494,1620.5322,837.5244,1626.7822,853.1494,1633.0322,846.8994,1626.7822" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="843.7744" x2="1501.3275" y1="1626.7822" y2="1626.7822"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="862.5244" y="1619.3527">24</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="317.244" x="891.3681" y="1619.3527">throw UnauthorizedException(msg)</text></g><g class="message" data-participant-1="ARC" data-participant-2="C"><polygon fill="#181818" points="138.7497,1665.1001,123.1247,1671.3501,138.7497,1677.6001,132.4997,1671.3501" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="129.3747" x2="834.3994" y1="1671.3501" y2="1671.3501"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="148.1247" y="1663.9206">25</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="274.6849" x="176.9684" y="1663.9206">403 Forbidden + {"error": msg}</text></g><line style="stroke:#000000;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="15.625" x2="1662.5931" y1="1685.4126" y2="1685.4126"/><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="261.6646" x="23.4375" y="1700.972">[IllegalStateException (conflict)]</text><g class="message" data-participant-1="ARS" data-participant-2="ARC"><polygon fill="#181818" points="853.1494,1731.9946,837.5244,1738.2446,853.1494,1744.4946,846.8994,1738.2446" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="843.7744" x2="1501.3275" y1="1738.2446" y2="1738.2446"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="862.5244" y="1730.8151">26</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="296.9215" x="891.3681" y="1730.8151">throw IllegalStateException(msg)</text></g><g class="message" data-participant-1="ARC" data-participant-2="C"><polygon fill="#181818" points="138.7497,1776.5625,123.1247,1782.8125,138.7497,1789.0625,132.4997,1782.8125" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="129.3747" x2="834.3994" y1="1782.8125" y2="1782.8125"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="148.1247" y="1775.383">27</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="250.9506" x="176.9684" y="1775.383">409 Conflict + {"error": msg}</text></g><line style="stroke:#000000;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="15.625" x2="1662.5931" y1="1796.875" y2="1796.875"/><text fill="#000000" font-family="Arial" font-size="17.1875" font-weight="bold" lengthAdjust="spacing" textLength="195.7848" x="23.4375" y="1812.4344">[Unexpected Exception]</text><g class="message" data-participant-1="ARS" data-participant-2="ARC"><polygon fill="#181818" points="853.1494,1843.457,837.5244,1849.707,853.1494,1855.957,846.8994,1849.707" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="843.7744" x2="1501.3275" y1="1849.707" y2="1849.707"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="862.5244" y="1842.2775">28</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="169.3436" x="891.3681" y="1842.2775">throw Exception(e)</text></g><g class="message" data-participant-1="ARC" data-participant-2="C"><polygon fill="#181818" points="138.7497,1910.7178,123.1247,1916.9678,138.7497,1923.2178,132.4997,1916.9678" style="stroke:#181818;stroke-width:1.5625;"/><line style="stroke:#181818;stroke-width:1.5625;stroke-dasharray:3.125,3.125;" x1="129.3747" x2="834.3994" y1="1916.9678" y2="1916.9678"/><text fill="#000000" font-family="Arial" font-size="20.3125" font-weight="bold" lengthAdjust="spacing" textLength="22.5937" x="148.1247" y="1898.1918">29</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="223.5367" x="176.9684" y="1886.8454">500 Internal Server Error</text><text fill="#000000" font-family="Arial" font-size="20.3125" lengthAdjust="spacing" textLength="477.5818" x="176.9684" y="1909.5383">+ {"error": "External service communication error: ..."}</text></g><!--SRC=[bLPBRkD64Dtp51KjnX9isVB4iuY0971asHO2snhHWqa00q6BB4cT8RivtKtPZcCWXyW1iii9SWBV92T9TPFYHnJXYG4lHDRdrQjNLTo3qSd-CVpxnvymKiWCmccII2vCZCB030EfGkYoY2y5Xd3FpGe26MBFqv-uI9XYCOG9X-DtWyeJlMAXlETY2GiMQQoyESC5IoDpBeMvPZ4bKvn5dcUuYP2G3C77pocA0E6CiwNrwBVZyZmM6AcWCrqzQXvm9c0KSNhV0QPXv55AGuyJHXuTFr4Ma8z1ghXvT2R-UCkeaYDBCIAWIaOHAkTmEdlDmKUrvW7crdxTUiMIVhB1Ik-d4-ZYWq4bMDHpBfVJov_hFbTIBENP3z3zIB0HheZytFRgvlhYvfUFBUPJ9N_5m70fY2qMDXrdTSSPcy-vkNeFuuTWnSGoAs5szPvOJeqKQJn7PGddQzkDaRS7VVgZuDGmRU1DGIrSM0FxqXj1_pjB6WnXUkFVmX5BEFqNdFML8qqVFLKUJiBde-pvdJXDpKeg_XkpXHp0J_qF6bL_Gf8iU9o4lGEOo_1n28rkvE1AsBQ15W_1ekOJh1NJUGxpsDqZzlt9Q79wlTU3xqilgnCM6TYWmT03vzylocDH9E_fQOWrBoJvmxKqm7QvMiUJmTTmBjMSXo4As8Ud3YebLMS8dSF3myxpdUXkIRVNJ5DxO6i4K6XI9JmKD2Pvgqenk_epfMQDsaKGoPVm1MxwCZgxjIuTK0v7xm5Kcr6DvHUvnxdCOKsx97Jj9Ca8gMBwdRKtGsApKd8x29JzOkn4KsHjA8NesOUQIc15SaTLmU66olMliaBmWMkZYIYNgL_K-tOmW9iVRICWeNXvfPK2uVVorz1QLLuzmtEz5ourG5vKbc5JDDPS-G84SKbBDXK4ltptz9ofg0fUaA8MaWoR-4y69qvmv_dhRJ1LGTHvUmDXcaGyiARBbD7UhpOaYqueA_nFA_Y_-hPM3dcObPBty46KqgVLWedDrGYQpNlU52fDGQtDPRW9oNV98jyGoY8ST0Cf5WJTz1gHYoP2pBMsSrJ48feSIoMi3J5JL9gGmBtRkR5TdJKoyjLB6JHROtFlTBDwh7AsHYQaioOa1Jy06k-UjubKDf05dneuadAPAxlCsn3DMX6Lvw0Tsswzjs6UjM5Evn7NAy2rLUgQCoXEInKmNHPoJ7BZvk5rQoSSso3_7x7XCSqIYvEUDtDvTm6zIKqWoGvYYafpz_AN9W46-FBtop-eZovlRwSGIlhSARUcMvMqI79qeDCWGAqNQHGzRiQyE0axhf5EfD3ONW-XqMo9lUs5xhlWvT5uEpWkCEot9ohEpvRCjv6sZ4CtrijNeTJsJUr-aNU-kdRlWDqeTjf-8PAsIreYUNLzx0Qrq-qBGNrZxwwBtieEFYGqczJBryWfSx-kaNTqo2OYlxhss9E0npRvdQXzPHINMUSV13GKSIhi7R3SEBiXk6-HvdU6lIR_0G00]--></g></svg>
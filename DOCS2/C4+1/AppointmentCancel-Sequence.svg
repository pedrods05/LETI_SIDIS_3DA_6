<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1510px" preserveAspectRatio="none" style="width:2096px;height:1510px;background:#FFFFFF;" version="1.1" viewBox="0 0 2096 1510" width="2096px" zoomAndPan="magnify"><title>Appointment Cancel - Sequence Diagram</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="274.6064" x="912.1948" y="30.1074">Appointment Cancel - Sequence Diagram</text><g><title>Client</title><rect fill="#FFFFFF" height="535.9473" style="stroke:#181818;stroke-width:1;" width="10" x="20.8965" y="133.2422"/></g><g><title>AppointmentController</title><rect fill="#FFFFFF" height="512.6563" style="stroke:#181818;stroke-width:1;" width="10" x="236.0044" y="156.5332"/></g><g><title>AppointmentCommandService</title><rect fill="#FFFFFF" height="432.7832" style="stroke:#181818;stroke-width:1;" width="10" x="477.855" y="187.8242"/></g><g><title>AppointmentService</title><rect fill="#FFFFFF" height="263.3281" style="stroke:#181818;stroke-width:1;" width="10" x="812.8809" y="219.1152"/></g><g><title>ExternalServiceClient</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1113.9805" y="250.4063"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1277.6592" y="312.9883"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1277.6592" y="419.8613"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1277.6592" y="990.7305"/></g><g><title>RabbitMQ</title><rect fill="#FFFFFF" height="197.0371" style="stroke:#181818;stroke-width:1;" width="10" x="1405.9312" y="558.0254"/></g><g><title>AppointmentEventHandler</title><rect fill="#FFFFFF" height="555.918" style="stroke:#181818;stroke-width:1;" width="10" x="1614.5518" y="755.0625"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1966.1724" y="786.3535"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1966.1724" y="1123.8945"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1966.1724" y="1257.6895"/></g><rect fill="none" height="471.3359" style="stroke:#000000;stroke-width:1.5;" width="897.0986" x="1192.8975" y="832.6445"/><rect fill="none" height="259.959" style="stroke:#000000;stroke-width:1.5;" width="559.1611" x="1520.835" y="1037.0215"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="21.8965" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="25" x2="25" y1="123.2422" y2="1427.4355"/></g><g><title>AppointmentController</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="237.0044" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="240.3564" x2="240.3564" y1="123.2422" y2="1427.4355"/></g><g><title>AppointmentCommandService</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="478.855" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="481.9209" x2="481.9209" y1="123.2422" y2="1427.4355"/></g><g><title>AppointmentService</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="813.8809" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="817.2363" x2="817.2363" y1="123.2422" y2="1427.4355"/></g><g><title>ExternalServiceClient</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="1114.9805" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1118.0635" x2="1118.0635" y1="123.2422" y2="1427.4355"/></g><g><title>AppointmentRepository</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="1278.6592" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1281.8975" x2="1281.8975" y1="123.2422" y2="1427.4355"/></g><g><title>RabbitMQ</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="1406.9312" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1410.4209" x2="1410.4209" y1="123.2422" y2="1427.4355"/></g><g><title>AppointmentEventHandler</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="1615.5518" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1618.835" x2="1618.835" y1="123.2422" y2="1427.4355"/></g><g><title>AppointmentQueryRepository</title><rect fill="#000000" fill-opacity="0.00000" height="1304.1934" width="8" x="1967.1724" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1970.3486" x2="1970.3486" y1="123.2422" y2="1427.4355"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="5" y="119.7285">Client</text><ellipse cx="25.8965" cy="53.1211" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M25.8965,61.1211 L25.8965,88.1211 M12.8965,69.1211 L38.8965,69.1211 M25.8965,88.1211 L12.8965,103.1211 M25.8965,88.1211 L38.8965,103.1211" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="5" y="1441.543">Client</text><ellipse cx="25.8965" cy="1453.5566" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M25.8965,1461.5566 L25.8965,1488.5566 M12.8965,1469.5566 L38.8965,1469.5566 M25.8965,1488.5566 L12.8965,1503.5566 M25.8965,1488.5566 L38.8965,1503.5566" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Controller"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.2959" x="164.3564" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.2959" x="171.3564" y="111.7285">AppointmentController</text></g><g class="participant participant-tail" data-participant="Controller"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.2959" x="164.3564" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.2959" x="171.3564" y="1448.543">AppointmentController</text></g><g class="participant participant-head" data-participant="CommandService"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="203.8682" x="380.9209" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189.8682" x="387.9209" y="111.7285">AppointmentCommandService</text></g><g class="participant participant-tail" data-participant="CommandService"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="203.8682" x="380.9209" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189.8682" x="387.9209" y="1448.543">AppointmentCommandService</text></g><g class="participant participant-head" data-participant="Service"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139.2891" x="748.2363" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.2891" x="755.2363" y="111.7285">AppointmentService</text></g><g class="participant participant-tail" data-participant="Service"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="139.2891" x="748.2363" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125.2891" x="755.2363" y="1448.543">AppointmentService</text></g><g class="participant participant-head" data-participant="ExternalClient"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.834" x="1045.0635" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.834" x="1052.0635" y="111.7285">ExternalServiceClient</text></g><g class="participant participant-tail" data-participant="ExternalClient"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.834" x="1045.0635" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.834" x="1052.0635" y="1448.543">ExternalServiceClient</text></g><g class="participant participant-head" data-participant="WriteRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="159.5234" x="1202.8975" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145.5234" x="1209.8975" y="93.1074">AppointmentRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.3447" x="1225.4868" y="111.7285">(Write Model - H2)</text></g><g class="participant participant-tail" data-participant="WriteRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="159.5234" x="1202.8975" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145.5234" x="1209.8975" y="1448.543">AppointmentRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.3447" x="1225.4868" y="1467.1641">(Write Model - H2)</text></g><g class="participant participant-head" data-participant="RabbitMQ"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.0205" x="1372.4209" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.0205" x="1379.4209" y="93.1074">RabbitMQ</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.2686" x="1379.7969" y="111.7285">Exchange</text></g><g class="participant participant-tail" data-participant="RabbitMQ"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.0205" x="1372.4209" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.0205" x="1379.4209" y="1448.543">RabbitMQ</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.2686" x="1379.7969" y="1467.1641">Exchange</text></g><g class="participant participant-head" data-participant="EventHandler"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177.4336" x="1530.835" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163.4336" x="1537.835" y="111.7285">AppointmentEventHandler</text></g><g class="participant participant-tail" data-participant="EventHandler"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177.4336" x="1530.835" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163.4336" x="1537.835" y="1448.543">AppointmentEventHandler</text></g><g class="participant participant-head" data-participant="ReadRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197.6475" x="1872.3486" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.6475" x="1879.3486" y="93.1074">AppointmentQueryRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.5098" x="1891.4175" y="111.7285">(Read Model - MongoDB)</text></g><g class="participant participant-tail" data-participant="ReadRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197.6475" x="1872.3486" y="1426.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.6475" x="1879.3486" y="1448.543">AppointmentQueryRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.5098" x="1891.4175" y="1467.1641">(Read Model - MongoDB)</text></g><g><title>Client</title><rect fill="#FFFFFF" height="535.9473" style="stroke:#181818;stroke-width:1;" width="10" x="20.8965" y="133.2422"/></g><g><title>AppointmentController</title><rect fill="#FFFFFF" height="512.6563" style="stroke:#181818;stroke-width:1;" width="10" x="236.0044" y="156.5332"/></g><g><title>AppointmentCommandService</title><rect fill="#FFFFFF" height="432.7832" style="stroke:#181818;stroke-width:1;" width="10" x="477.855" y="187.8242"/></g><g><title>AppointmentService</title><rect fill="#FFFFFF" height="263.3281" style="stroke:#181818;stroke-width:1;" width="10" x="812.8809" y="219.1152"/></g><g><title>ExternalServiceClient</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1113.9805" y="250.4063"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1277.6592" y="312.9883"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1277.6592" y="419.8613"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1277.6592" y="990.7305"/></g><g><title>RabbitMQ</title><rect fill="#FFFFFF" height="197.0371" style="stroke:#181818;stroke-width:1;" width="10" x="1405.9312" y="558.0254"/></g><g><title>AppointmentEventHandler</title><rect fill="#FFFFFF" height="555.918" style="stroke:#181818;stroke-width:1;" width="10" x="1614.5518" y="755.0625"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1966.1724" y="786.3535"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1966.1724" y="1123.8945"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1966.1724" y="1257.6895"/></g><g class="message" data-participant-1="Client" data-participant-2="Controller"><polygon fill="#181818" points="224.0044,152.5332,234.0044,156.5332,224.0044,160.5332,228.0044,156.5332" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="30.8965" x2="230.0044" y1="156.5332" y2="156.5332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="40.3965" y="151.2705">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.8779" x="51.6265" y="151.2705">PUT /appointments/{id}/cancel</text></g><g class="message" data-participant-1="Controller" data-participant-2="CommandService"><polygon fill="#181818" points="465.855,183.8242,475.855,187.8242,465.855,191.8242,469.855,187.8242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="246.0044" x2="471.855" y1="187.8242" y2="187.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="255.5044" y="182.5615">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.6206" x="266.7344" y="182.5615">cancelAppointment(appointmentId)</text></g><g class="message" data-participant-1="CommandService" data-participant-2="Service"><polygon fill="#181818" points="800.8809,215.1152,810.8809,219.1152,800.8809,223.1152,804.8809,219.1152" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="487.855" x2="806.8809" y1="219.1152" y2="219.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="543.9426" y="213.8525">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.6206" x="555.1726" y="213.8525">cancelAppointment(appointmentId)</text></g><g class="message" data-participant-1="Service" data-participant-2="ExternalClient"><polygon fill="#181818" points="1101.9805,246.4063,1111.9805,250.4063,1101.9805,254.4063,1105.9805,250.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="822.8809" x2="1107.9805" y1="250.4063" y2="250.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="832.3809" y="245.1436">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260.8696" x="843.6108" y="245.1436">cancelAppointmentInRecords(appointmentId)</text></g><g class="message" data-participant-1="ExternalClient" data-participant-2="Service"><polygon fill="#181818" points="833.8809,277.6973,823.8809,281.6973,833.8809,285.6973,829.8809,281.6973" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="827.8809" x2="1117.9805" y1="281.6973" y2="281.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="872.8176" y="276.4346">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.9961" x="884.0476" y="276.4346">Canceled (or exception ignored)</text></g><g class="message" data-participant-1="Service" data-participant-2="WriteRepo"><polygon fill="#181818" points="1265.6592,308.9883,1275.6592,312.9883,1265.6592,316.9883,1269.6592,312.9883" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="822.8809" x2="1271.6592" y1="312.9883" y2="312.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="975.6433" y="307.7256">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="986.8733" y="307.7256">findById(appointmentId)</text></g><g class="message" data-participant-1="WriteRepo" data-participant-2="Service"><polygon fill="#181818" points="833.8809,340.2793,823.8809,344.2793,833.8809,348.2793,829.8809,344.2793" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="827.8809" x2="1281.6592" y1="344.2793" y2="344.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="978.8574" y="339.0166">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.5952" x="990.0874" y="339.0166">Optional&lt;Appointment&gt;</text></g><g class="message" data-participant-1="Service" data-participant-2="Service"><line style="stroke:#181818;stroke-width:2;" x1="822.8809" x2="864.8809" y1="375.5703" y2="375.5703"/><line style="stroke:#181818;stroke-width:2;" x1="864.8809" x2="864.8809" y1="375.5703" y2="388.5703"/><line style="stroke:#181818;stroke-width:2;" x1="823.8809" x2="864.8809" y1="388.5703" y2="388.5703"/><polygon fill="#181818" points="833.8809,384.5703,823.8809,388.5703,833.8809,392.5703,829.8809,388.5703" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="829.8809" y="370.3076">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.4189" x="841.1108" y="370.3076">Set status = CANCELED</text></g><g class="message" data-participant-1="Service" data-participant-2="WriteRepo"><polygon fill="#181818" points="1265.6592,415.8613,1275.6592,419.8613,1265.6592,423.8613,1269.6592,419.8613" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="822.8809" x2="1271.6592" y1="419.8613" y2="419.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="990.8206" y="414.5986">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.6689" x="1002.0505" y="414.5986">save(appointment)</text></g><g class="message" data-participant-1="WriteRepo" data-participant-2="Service"><polygon fill="#181818" points="833.8809,447.1523,823.8809,451.1523,833.8809,455.1523,829.8809,451.1523" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="827.8809" x2="1281.6592" y1="451.1523" y2="451.1523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="940.762" y="445.8896">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.5562" x="959.2219" y="445.8896">Appointment (status = CANCELED)</text></g><g class="message" data-participant-1="Service" data-participant-2="CommandService"><polygon fill="#181818" points="498.855,478.4434,488.855,482.4434,498.855,486.4434,494.855,482.4434" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="492.855" x2="816.8809" y1="482.4434" y2="482.4434"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="607.1421" y="477.1807">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9917" x="625.6021" y="477.1807">Appointment</text></g><g class="message" data-participant-1="CommandService" data-participant-2="CommandService"><line style="stroke:#181818;stroke-width:2;" x1="487.855" x2="529.855" y1="513.7344" y2="513.7344"/><line style="stroke:#181818;stroke-width:2;" x1="529.855" x2="529.855" y1="513.7344" y2="526.7344"/><line style="stroke:#181818;stroke-width:2;" x1="488.855" x2="529.855" y1="526.7344" y2="526.7344"/><polygon fill="#181818" points="498.855,522.7344,488.855,526.7344,498.855,530.7344,494.855,526.7344" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="494.855" y="508.4717">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.5659" x="513.3149" y="508.4717">publishAppointmentCanceledEvent(appointment)</text></g><g class="message" data-participant-1="CommandService" data-participant-2="RabbitMQ"><polygon fill="#181818" points="1393.9312,554.0254,1403.9312,558.0254,1393.9312,562.0254,1397.9312,558.0254" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="487.855" x2="1399.9312" y1="558.0254" y2="558.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="797.5449" y="552.7627">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280.2363" x="816.0049" y="552.7627">convertAndSend("appointment.canceled", event)</text></g><g class="message" data-participant-1="RabbitMQ" data-participant-2="CommandService"><polygon fill="#181818" points="498.855,585.3164,488.855,589.3164,498.855,593.3164,494.855,589.3164" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="492.855" x2="1404.9312" y1="589.3164" y2="589.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="891.4077" y="584.0537">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.5107" x="909.8677" y="584.0537">Event published</text></g><g class="message" data-participant-1="CommandService" data-participant-2="Controller"><polygon fill="#181818" points="257.0044,616.6074,247.0044,620.6074,257.0044,624.6074,253.0044,620.6074" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="251.0044" x2="481.855" y1="620.6074" y2="620.6074"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="318.7039" y="615.3447">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.9917" x="337.1638" y="615.3447">Appointment</text></g><g class="message" data-participant-1="Controller" data-participant-2="Client"><polygon fill="#181818" points="36.8965,665.1895,26.8965,669.1895,36.8965,673.1895,32.8965,669.1895" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="30.8965" x2="240.0044" y1="669.1895" y2="669.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="46.1919" y="655.2813">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.0845" x="120.6382" y="646.6357">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0571" x="64.6519" y="663.9268">Appointment (CANCELED)</text></g><path d="M1420,682.1895 L1420,726.1895 L1615,726.1895 L1615,692.1895 L1605,682.1895 L1420,682.1895" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1605,682.1895 L1605,692.1895 L1615,692.1895 L1605,682.1895" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.4707" x="1426" y="701.2178">Asynchronous processing:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174.1543" x="1426" y="718.5088">Event is consumed by handler</text><g class="message" data-participant-1="RabbitMQ" data-participant-2="EventHandler"><polygon fill="#181818" points="1602.5518,751.0625,1612.5518,755.0625,1602.5518,759.0625,1606.5518,755.0625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1410.9312" x2="1608.5518" y1="755.0625" y2="755.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1422.9312" y="749.7998">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.1606" x="1441.3911" y="749.7998">AppointmentCanceledEvent</text></g><g class="message" data-participant-1="EventHandler" data-participant-2="ReadRepo"><polygon fill="#181818" points="1954.1724,782.3535,1964.1724,786.3535,1954.1724,790.3535,1958.1724,786.3535" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1624.5518" x2="1960.1724" y1="786.3535" y2="786.3535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1717.1204" y="781.0908">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="1735.5803" y="781.0908">findById(appointmentId)</text></g><g class="message" data-participant-1="ReadRepo" data-participant-2="EventHandler"><polygon fill="#181818" points="1635.5518,813.6445,1625.5518,817.6445,1635.5518,821.6445,1631.5518,817.6445" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="1629.5518" x2="1970.1724" y1="817.6445" y2="817.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1692.5254" y="812.3818">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.2134" x="1710.9854" y="812.3818">Optional&lt;AppointmentSummary&gt;</text></g><path d="M1192.8975,832.6445 L1253.0684,832.6445 L1253.0684,841.9355 L1243.0684,851.9355 L1192.8975,851.9355 L1192.8975,832.6445" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="471.3359" style="stroke:#000000;stroke-width:1.5;" width="897.0986" x="1192.8975" y="832.6445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="1207.8975" y="847.6729">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="319.6768" x="1268.0684" y="846.5146">[Summary exists and status is SCHEDULED or COMPLETED]</text><g class="message" data-participant-1="EventHandler" data-participant-2="EventHandler"><line style="stroke:#181818;stroke-width:2;" x1="1624.5518" x2="1666.5518" y1="875.2266" y2="875.2266"/><line style="stroke:#181818;stroke-width:2;" x1="1666.5518" x2="1666.5518" y1="875.2266" y2="888.2266"/><line style="stroke:#181818;stroke-width:2;" x1="1625.5518" x2="1666.5518" y1="888.2266" y2="888.2266"/><polygon fill="#181818" points="1635.5518,884.2266,1625.5518,888.2266,1635.5518,892.2266,1631.5518,888.2266" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1631.5518" y="869.9639">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.5024" x="1650.0117" y="869.9639">Ignore old cancellation event</text></g><path d="M1629,901.2266 L1629,945.2266 L1794,945.2266 L1794,911.2266 L1784,901.2266 L1629,901.2266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1784,901.2266 L1784,911.2266 L1794,911.2266 L1784,901.2266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.498" x="1635" y="920.2549">Prevents overwriting with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.5171" x="1635" y="937.5459">outdated events</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="1192.8975" x2="2089.9961" y1="951.8086" y2="951.8086"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="280.1401" x="1197.8975" y="963.6787">[Summary doesn't exist or status allows cancellation]</text><g class="message" data-participant-1="EventHandler" data-participant-2="WriteRepo"><polygon fill="#181818" points="1298.6592,986.7305,1288.6592,990.7305,1298.6592,994.7305,1294.6592,990.7305" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1292.6592" x2="1613.5518" y1="990.7305" y2="990.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1372.8638" y="985.4678">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="1391.3237" y="985.4678">findById(appointmentId)</text></g><g class="message" data-participant-1="WriteRepo" data-participant-2="EventHandler"><polygon fill="#181818" points="1602.5518,1018.0215,1612.5518,1022.0215,1602.5518,1026.0215,1606.5518,1022.0215" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="1282.6592" x2="1608.5518" y1="1022.0215" y2="1022.0215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1371.0779" y="1016.7588">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.5952" x="1389.5378" y="1016.7588">Optional&lt;Appointment&gt;</text></g><path d="M1520.835,1037.0215 L1581.0059,1037.0215 L1581.0059,1046.3125 L1571.0059,1056.3125 L1520.835,1056.3125 L1520.835,1037.0215" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="259.959" style="stroke:#000000;stroke-width:1.5;" width="559.1611" x="1520.835" y="1037.0215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="1535.835" y="1052.0498">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="185.7539" x="1596.0059" y="1050.8916">[Appointment found in write model]</text><g class="message" data-participant-1="EventHandler" data-participant-2="EventHandler"><line style="stroke:#181818;stroke-width:2;" x1="1624.5518" x2="1666.5518" y1="1079.6035" y2="1079.6035"/><line style="stroke:#181818;stroke-width:2;" x1="1666.5518" x2="1666.5518" y1="1079.6035" y2="1092.6035"/><line style="stroke:#181818;stroke-width:2;" x1="1625.5518" x2="1666.5518" y1="1092.6035" y2="1092.6035"/><polygon fill="#181818" points="1635.5518,1088.6035,1625.5518,1092.6035,1635.5518,1096.6035,1631.5518,1092.6035" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1631.5518" y="1074.3408">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.7598" x="1650.0117" y="1074.3408">Preserve all appointment fields</text></g><g class="message" data-participant-1="EventHandler" data-participant-2="ReadRepo"><polygon fill="#181818" points="1954.1724,1119.8945,1964.1724,1123.8945,1954.1724,1127.8945,1958.1724,1123.8945" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1624.5518" x2="1960.1724" y1="1123.8945" y2="1123.8945"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1634.0518" y="1118.6318">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304.1606" x="1652.5117" y="1118.6318">save(AppointmentSummary with status CANCELED)</text></g><g class="message" data-participant-1="ReadRepo" data-participant-2="EventHandler"><polygon fill="#181818" points="1635.5518,1151.1855,1625.5518,1155.1855,1635.5518,1159.1855,1631.5518,1155.1855" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="1629.5518" x2="1970.1724" y1="1155.1855" y2="1155.1855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1770.2017" y="1149.9229">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.8608" x="1788.6616" y="1149.9229">Saved</text></g><path d="M1629,1168.1855 L1629,1212.1855 L1835,1212.1855 L1835,1178.1855 L1825,1168.1855 L1629,1168.1855" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1825,1168.1855 L1825,1178.1855 L1835,1178.1855 L1825,1168.1855" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.709" x="1635" y="1187.2139">Preserves all fields from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.707" x="1635" y="1204.5049">write model, only updates status</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="1520.835" x2="2079.9961" y1="1218.7676" y2="1218.7676"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="128.9009" x="1525.835" y="1230.6377">[Appointment not found]</text><g class="message" data-participant-1="EventHandler" data-participant-2="ReadRepo"><polygon fill="#181818" points="1954.1724,1253.6895,1964.1724,1257.6895,1954.1724,1261.6895,1958.1724,1257.6895" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="1624.5518" x2="1960.1724" y1="1257.6895" y2="1257.6895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1671.2554" y="1252.4268">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.7534" x="1689.7153" y="1252.4268">save(AppointmentSummary from event)</text></g><g class="message" data-participant-1="ReadRepo" data-participant-2="EventHandler"><polygon fill="#181818" points="1635.5518,1284.9805,1625.5518,1288.9805,1635.5518,1292.9805,1631.5518,1288.9805" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="1629.5518" x2="1970.1724" y1="1288.9805" y2="1288.9805"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="1770.2017" y="1283.7178">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.8608" x="1788.6616" y="1283.7178">Saved</text></g><path d="M246,1315.9805 L246,1411.9805 L592,1411.9805 L592,1325.9805 L582,1315.9805 L246,1315.9805" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M582,1315.9805 L582,1325.9805 L592,1325.9805 L582,1315.9805" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325.1714" x="252" y="1335.0088">Este diagrama mostra o cancelamento de uma consulta.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="314.3169" x="252" y="1352.2998">O status &#233; atualizado para CANCELED no write model</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286.1714" x="252" y="1369.5908">e um evento &#233; publicado no RabbitMQ. O handler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305.6714" x="252" y="1386.8818">atualiza o read model (MongoDB) preservando todos</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.5596" x="252" y="1404.1729">os campos originais e apenas alterando o status.</text><!--SRC=[lLVDRjiu4BxhAGRPGnsWIOeSWzq0hkD5WjQRD4xHIowqoCX4A59BKdQyHH-epx4lrY55IQGjnzrTO7sm9NBcq_nyyuasprnMH9CI5YH_BhIg9PqeeJJyyhl_PAQpCEpFcicSpPWnf61ZmGi9EPEMwG6hiTPg_R3a-RD4UpZFCikjO32kAiMbBT4F9WGD1Pp0F3Z15IS5ecGPoIq6CH4SxJ94jZpd5K6VemXWegJLIWYcZu0Ow6zVyIXB8kcSwHNFMV2Ab_PwnYw3jjCNB8Ga8cmseNlpTkT0DlUiKePZsfj7EVgYkMKmKzJNv_hys2FvLMUNWjoJnOBRsQT7ENt9bqGMJPZjyjudJbVuTOt9jnMC5_PwVQgPtYJ1tZD2krXdIXRgwdqJiDlnyMQajahMvGA1iRTyHJ2zK93c1qukemvUmDtd1pWZ_MFDsLTElvtbdZCHHj_qhBzkmEB6Na3Z6IKoYj1lw76CcL0YI-yTzhy0xT0Yc9GP0sWtyfxbIbEp5tQBNEajdCInDkF6A8nmjDXBpYhBbGGSOwKPObAs3pMEkUFW1JnnITzlRkZUu7g-TbTfIBS-129-ZNA-Z0Ff4RAXyi-P1ME9hGty1fFn7vFfn-dLdcWDMR4uqdyIPwnQevq77X-AU82D4MBi_GhdjX6gUY6uMSRg5XhinpXDTHUkLGTadP8hfktORKiwEeeSJ_C0UVGMs2ejMYSlxSLWdZwMDbP6iztCjkP-Js5sPxAVTOSG9kZytJku_V0eauODzYaIZdWr45uglD6yM5fGJtsg06EpaVbIAwcG0fLMERxTk2mkSAj9bHjNK5ENE6YB3Io3cc9bmO5cKRak4y5DKazQ6GVOXTBFQYpQMNpdsnmK-2UcjHFhzi9NDWrnQ63dDRP6RvAvZOHVM0WMA3hSM0C8raujLci-kPvUVSRsW7lZtyxkFauVS8W10BQJIMEvyS85Ij0Wd89uGVD4zVvf5vD2WV_SQMziGE44h75oiPMmvdOPzbLjAQP36qpZLxjECc5ObnfLpCWtjadHPH8I94AejKa274pj9sJLkGt8Z5jEPUjmoowzrx1g-STWq-8HUd87G-0IrlvSKhftVIZHeIvXYGqEBNEL019ZSYQesOlI4zSBzoxVV9_QClSZtkBjKh7TUONUStmKxGo7-Dpk7QHMe9VFtTCW90nFMfMHJLJHjw2as41TESwPa5fdsl7EtpZknHt2dQPB_w6WBh9Mvl-7Cc92JXQpvE2HY5bQv4YnCJk3MxJvkq2mVCPg0YhC6N5PANmmrBZfvLXOSefkjorX_luE-4i4_ujG1Uw_IySXhEKMpnrEKnZb7FtRB7T-QDaAyYbYBpi6jDWOadQdOuy4e_PmZ6yEpmoqLs0LLQxDoib4YUTgb0zUS4bG775iAYQ98n2UoBov2YcSzk-K7m00]--></g></svg>
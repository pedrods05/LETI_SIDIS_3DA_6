<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="896px" preserveAspectRatio="none" style="width:1057px;height:896px;background:#FFFFFF;" version="1.1" viewBox="0 0 1057 896" width="1057px" zoomAndPan="magnify"><title>Get Appointment Audit Trail - Sequence Diagram</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="325.1445" x="365.2715" y="30.1074">Get Appointment Audit Trail - Sequence Diagram</text><g><title>Client</title><rect fill="#FFFFFF" height="563.918" style="stroke:#181818;stroke-width:1;" width="10" x="35.8965" y="133.2422"/></g><g><title>AppointmentController</title><rect fill="#FFFFFF" height="540.627" style="stroke:#181818;stroke-width:1;" width="10" x="339.8906" y="156.5332"/></g><g><title>EventStoreService</title><rect fill="#FFFFFF" height="93.873" style="stroke:#181818;stroke-width:1;" width="10" x="598.9922" y="187.8242"/></g><g><title>EventStoreRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="971.5981" y="219.1152"/></g><rect fill="none" height="219.377" style="stroke:#000000;stroke-width:1.5;" width="365.7495" x="248.2427" y="340.9883"/><rect fill="none" height="186.0859" style="stroke:#000000;stroke-width:1.5;" width="345.7495" x="258.2427" y="367.2793"/><rect fill="none" height="115.7949" style="stroke:#000000;stroke-width:1.5;" width="421.5386" x="10" y="574.3652"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="690.373" width="8" x="36.8965" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="40" x2="40" y1="123.2422" y2="813.6152"/></g><g><title>AppointmentController</title><rect fill="#000000" fill-opacity="0.00000" height="690.373" width="8" x="340.8906" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="344.2427" x2="344.2427" y1="123.2422" y2="813.6152"/></g><g><title>EventStoreService</title><rect fill="#000000" fill-opacity="0.00000" height="690.373" width="8" x="599.9922" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="603.02" x2="603.02" y1="123.2422" y2="813.6152"/></g><g><title>EventStoreRepository</title><rect fill="#000000" fill-opacity="0.00000" height="690.373" width="8" x="972.5981" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="976.5088" x2="976.5088" y1="123.2422" y2="813.6152"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="20" y="119.7285">Client</text><ellipse cx="40.8965" cy="53.1211" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M40.8965,61.1211 L40.8965,88.1211 M27.8965,69.1211 L53.8965,69.1211 M40.8965,88.1211 L27.8965,103.1211 M40.8965,88.1211 L53.8965,103.1211" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="20" y="827.7227">Client</text><ellipse cx="40.8965" cy="839.7363" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M40.8965,847.7363 L40.8965,874.7363 M27.8965,855.7363 L53.8965,855.7363 M40.8965,874.7363 L27.8965,889.7363 M40.8965,874.7363 L53.8965,889.7363" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Controller"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.2959" x="268.2427" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.2959" x="275.2427" y="111.7285">AppointmentController</text></g><g class="participant participant-tail" data-participant="Controller"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.2959" x="268.2427" y="812.6152"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.2959" x="275.2427" y="834.7227">AppointmentController</text></g><g class="participant participant-head" data-participant="EventStoreService"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.9443" x="539.02" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.9443" x="546.02" y="111.7285">EventStoreService</text></g><g class="participant participant-tail" data-participant="EventStoreService"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.9443" x="539.02" y="812.6152"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.9443" x="546.02" y="834.7227">EventStoreService</text></g><g class="participant participant-head" data-participant="EventStoreRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="150.1787" x="901.5088" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.1787" x="908.5088" y="93.1074">EventStoreRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112.8135" x="920.1914" y="111.7285">(Event Store - H2)</text></g><g class="participant participant-tail" data-participant="EventStoreRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="150.1787" x="901.5088" y="812.6152"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.1787" x="908.5088" y="834.7227">EventStoreRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112.8135" x="920.1914" y="853.3438">(Event Store - H2)</text></g><g><title>Client</title><rect fill="#FFFFFF" height="563.918" style="stroke:#181818;stroke-width:1;" width="10" x="35.8965" y="133.2422"/></g><g><title>AppointmentController</title><rect fill="#FFFFFF" height="540.627" style="stroke:#181818;stroke-width:1;" width="10" x="339.8906" y="156.5332"/></g><g><title>EventStoreService</title><rect fill="#FFFFFF" height="93.873" style="stroke:#181818;stroke-width:1;" width="10" x="598.9922" y="187.8242"/></g><g><title>EventStoreRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="971.5981" y="219.1152"/></g><g class="message" data-participant-1="Client" data-participant-2="Controller"><polygon fill="#181818" points="327.8906,152.5332,337.8906,156.5332,327.8906,160.5332,331.8906,156.5332" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="45.8965" x2="333.8906" y1="156.5332" y2="156.5332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="55.3965" y="151.2705">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.7642" x="66.6265" y="151.2705">GET /appointments/{appointmentId}/audit-trail</text></g><g class="message" data-participant-1="Controller" data-participant-2="EventStoreService"><polygon fill="#181818" points="586.9922,183.8242,596.9922,187.8242,586.9922,191.8242,590.9922,187.8242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="349.8906" x2="592.9922" y1="187.8242" y2="187.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="377.4202" y="182.5615">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.8125" x="388.6501" y="182.5615">getEventHistory(appointmentId)</text></g><g class="message" data-participant-1="EventStoreService" data-participant-2="EventStoreRepo"><polygon fill="#181818" points="959.5981,215.1152,969.5981,219.1152,959.5981,223.1152,963.5981,219.1152" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="608.9922" x2="965.5981" y1="219.1152" y2="219.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="618.4922" y="213.8525">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="332.376" x="629.7222" y="213.8525">findByAggregateIdOrderByTimestampAsc(appointmentId)</text></g><g class="message" data-participant-1="EventStoreRepo" data-participant-2="EventStoreService"><polygon fill="#181818" points="619.9922,246.4063,609.9922,250.4063,619.9922,254.4063,615.9922,250.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="613.9922" x2="975.5981" y1="250.4063" y2="250.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="737.3162" y="245.1436">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.728" x="748.5461" y="245.1436">List&lt;EventStore&gt;</text></g><g class="message" data-participant-1="EventStoreService" data-participant-2="Controller"><polygon fill="#181818" points="360.8906,277.6973,350.8906,281.6973,360.8906,285.6973,356.8906,281.6973" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="354.8906" x2="602.9922" y1="281.6973" y2="281.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="421.4624" y="276.4346">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.728" x="432.6924" y="276.4346">List&lt;EventStore&gt;</text></g><g class="message" data-participant-1="Controller" data-participant-2="Controller"><line style="stroke:#181818;stroke-width:2;" x1="349.8906" x2="391.8906" y1="312.9883" y2="312.9883"/><line style="stroke:#181818;stroke-width:2;" x1="391.8906" x2="391.8906" y1="312.9883" y2="325.9883"/><line style="stroke:#181818;stroke-width:2;" x1="350.8906" x2="391.8906" y1="325.9883" y2="325.9883"/><polygon fill="#181818" points="360.8906,321.9883,350.8906,325.9883,360.8906,329.9883,356.8906,325.9883" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="356.8906" y="307.7256">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.6162" x="368.1206" y="307.7256">Map events to AuditTrailDTO</text></g><path d="M248.2427,340.9883 L320.6772,340.9883 L320.6772,350.2793 L310.6772,360.2793 L248.2427,360.2793 L248.2427,340.9883" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="219.377" style="stroke:#000000;stroke-width:1.5;" width="365.7495" x="248.2427" y="340.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.4346" x="263.2427" y="356.0166">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114.3022" x="335.6772" y="354.8584">[For each EventStore]</text><path d="M258.2427,367.2793 L318.4136,367.2793 L318.4136,376.5703 L308.4136,386.5703 L258.2427,386.5703 L258.2427,367.2793" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="186.0859" style="stroke:#000000;stroke-width:1.5;" width="345.7495" x="258.2427" y="367.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="273.2427" y="382.3076">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="100.8745" x="333.4136" y="381.1494">[Parsing succeeds]</text><g class="message" data-participant-1="Controller" data-participant-2="Controller"><line style="stroke:#181818;stroke-width:2;" x1="349.8906" x2="391.8906" y1="427.1523" y2="427.1523"/><line style="stroke:#181818;stroke-width:2;" x1="391.8906" x2="391.8906" y1="427.1523" y2="440.1523"/><line style="stroke:#181818;stroke-width:2;" x1="350.8906" x2="391.8906" y1="440.1523" y2="440.1523"/><polygon fill="#181818" points="360.8906,436.1523,350.8906,440.1523,360.8906,444.1523,356.8906,440.1523" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="356.8906" y="413.2441">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.8799" x="368.1206" y="404.5986">Parse JSON to Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.998" x="369.5615" y="421.8896">(using ObjectMapper)</text></g><g class="message" data-participant-1="Controller" data-participant-2="Controller"><line style="stroke:#181818;stroke-width:2;" x1="349.8906" x2="391.8906" y1="471.4434" y2="471.4434"/><line style="stroke:#181818;stroke-width:2;" x1="391.8906" x2="391.8906" y1="471.4434" y2="484.4434"/><line style="stroke:#181818;stroke-width:2;" x1="350.8906" x2="391.8906" y1="484.4434" y2="484.4434"/><polygon fill="#181818" points="360.8906,480.4434,350.8906,484.4434,360.8906,488.4434,356.8906,484.4434" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="356.8906" y="466.1807">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.8716" x="368.1206" y="466.1807">Build AuditTrailDTO with parsed data</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="258.2427" x2="603.9922" y1="493.4434" y2="493.4434"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="72.7407" x="263.2427" y="505.3135">[Parsing fails]</text><g class="message" data-participant-1="Controller" data-participant-2="Controller"><line style="stroke:#181818;stroke-width:2;" x1="349.8906" x2="391.8906" y1="532.3652" y2="532.3652"/><line style="stroke:#181818;stroke-width:2;" x1="391.8906" x2="391.8906" y1="532.3652" y2="545.3652"/><line style="stroke:#181818;stroke-width:2;" x1="350.8906" x2="391.8906" y1="545.3652" y2="545.3652"/><polygon fill="#181818" points="360.8906,541.3652,350.8906,545.3652,360.8906,549.3652,356.8906,545.3652" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="356.8906" y="527.1025">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.0571" x="368.1206" y="527.1025">Build AuditTrailDTO with raw strings</text></g><path d="M10,574.3652 L70.1709,574.3652 L70.1709,583.6563 L60.1709,593.6563 L10,593.6563 L10,574.3652" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="115.7949" style="stroke:#000000;stroke-width:1.5;" width="421.5386" x="10" y="574.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="25" y="589.3936">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51.9707" x="85.1709" y="588.2354">[Success]</text><g class="message" data-participant-1="Controller" data-participant-2="Client"><polygon fill="#181818" points="56.8965,630.2383,46.8965,634.2383,56.8965,638.2383,52.8965,634.2383" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="50.8965" x2="338.8906" y1="634.2383" y2="634.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="124.7827" y="620.3301">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.0845" x="180.0813" y="611.6846">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.7617" x="143.2427" y="628.9756">List&lt;AuditTrailDTO&gt;</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="431.5386" y1="643.2383" y2="643.2383"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="59.8931" x="15" y="655.1084">[Exception]</text><g class="message" data-participant-1="Controller" data-participant-2="Client"><polygon fill="#181818" points="56.8965,678.1602,46.8965,682.1602,56.8965,686.1602,52.8965,682.1602" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="50.8965" x2="338.8906" y1="682.1602" y2="682.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="112.1318" y="676.8975">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.0635" x="130.5918" y="676.8975">500 Internal Server Error</text></g><path d="M349,702.1602 L349,798.1602 L668,798.1602 L668,712.1602 L658,702.1602 L349,702.1602" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M658,702.1602 L658,712.1602 L668,712.1602 L658,702.1602" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283.9751" x="355" y="721.1885">Este diagrama mostra a recupera&#231;&#227;o do hist&#243;rico</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283.9878" x="355" y="738.4795">completo de eventos (audit trail) de uma consulta</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289.7959" x="355" y="755.7705">usando Event Sourcing. Retorna todos os eventos</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283.9878" x="355" y="773.0615">ordenados cronologicamente, permitindo rastrear</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298.4604" x="355" y="790.3525">todas as mudan&#231;as e a&#231;&#245;es realizadas na consulta.</text><!--SRC=[fPNDJXin4CVlVeeHlH2f0OJKIrGX1GWVRMagaYENmHusBbvxQtkXjE9fUk01gZv1NgnZBx2x12gahX9bFPxvpVp77mcNsbReiOHpb9U5TxLLUyuu3syEyYF2eqUWRpLPIISK0XOqDhgm8Cb6yizuZRrtr_E5bfUM_M5RYAYZ8JYa2EEgSjh6acDXN2iTOUvH6nZ2x3uQzZKMZ1C2PUHgzencPy4fefQwGWvSwr3sd8tU6KD-3J10E-n7JAxOTyOycf6_qfAozuhrfQ1JgbpG_7PpPjUp6RATwpxQ7ZnX9MUklexErkKvLy92z1L6Uj3I_C1mfrFk20udSzZ4LbdO_DaP7QlRJKmD6yRKi0wpLIpQzmHVKJU2WcAs7kcGnApt4WnQw6fZn8gfdoA97i65jchtPbmKdWhc7AkfL-HtR-Qwf12nhCP1lY9fxc1_2CFd5NrY9UzR-uvGz1BmEGbFrk1rjCUUzFlT1PrW1PG20aJNxFIyqVVdKs6Sg-20jpQp5nsi07xGHFY2FcXRGAYb958XJwJdvNmfXE33RFevvPkUVoKPUQlMcTCCkQIA_E0LiDrQ6zKl6gvrN42LiYXG635Zo73IXsels3Fy3ztZDOJecTLWo2gHlYBrP9Pw4Pg9BZl1yt4QmVRM5am_djcyY3t-ZiYLJhvBgg9szb-KTqmvJZURHGDffNb-mZUQpxLqzaFdu7MjpH4Nrl70ws8HmLrqVG4cWQTKSyiXb8ur8o1uaZKl42xlbhySA0SBrh7yxRLq72HTMHdYjLNKR2mNO3rV290lX46Qg9addGsroGjK1xJCkR-lNEqbztO3JXd3wdYZA8Rmvvx74OwFgyLabjvP_ZSejCHqKEajS6sbZZeHFNBDX4aCG_ZouqzPAxJBEtuZI1h-K619QFGFJ1wshMmZTH9IWyHV]--></g></svg>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1511px" preserveAspectRatio="none" style="width:1432px;height:1511px;background:#FFFFFF;" version="1.1" viewBox="0 0 1432 1511" width="1432px" zoomAndPan="magnify"><title>View Future Appointments - Sequence Diagram</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="315.8271" x="559.2393" y="30.1074">View Future Appointments - Sequence Diagram</text><g><title>Client</title><rect fill="#FFFFFF" height="1098.5742" style="stroke:#181818;stroke-width:1;" width="10" x="20.8965" y="133.2422"/></g><g><title>AppointmentController</title><rect fill="#FFFFFF" height="1075.2832" style="stroke:#181818;stroke-width:1;" width="10" x="233.1035" y="156.5332"/></g><g><title>AppointmentQueryService</title><rect fill="#FFFFFF" height="1003.4102" style="stroke:#181818;stroke-width:1;" width="10" x="441.6396" y="187.8242"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="804.0493" y="219.1152"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="992.6348" y="422.8613"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="992.6348" y="644.8984"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="992.6348" y="962.4883"/></g><g><title>AppointmentMapper</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1152.4341" y="851.9844"/></g><g><title>AppointmentMapper</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1152.4341" y="1113.6523"/></g><g><title>ExternalServiceClient</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1306.3887" y="582.3164"/></g><g><title>ExternalServiceClient</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1306.3887" y="775.4023"/></g><rect fill="none" height="874.5371" style="stroke:#000000;stroke-width:1.5;" width="1273.8501" x="151.4556" y="309.6973"/><rect fill="none" height="441.4141" style="stroke:#000000;stroke-width:1.5;" width="1087.3726" x="327.9331" y="380.2793"/><rect fill="none" height="345.541" style="stroke:#000000;stroke-width:1.5;" width="1067.3726" x="337.9331" y="469.1523"/><rect fill="none" height="144.4551" style="stroke:#000000;stroke-width:1.5;" width="1047.3726" x="347.9331" y="539.7344"/><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="1304.9023" width="8" x="21.8965" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="25" x2="25" y1="123.2422" y2="1428.1445"/></g><g><title>AppointmentController</title><rect fill="#000000" fill-opacity="0.00000" height="1304.9023" width="8" x="234.1035" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="237.4556" x2="237.4556" y1="123.2422" y2="1428.1445"/></g><g><title>AppointmentQueryService</title><rect fill="#000000" fill-opacity="0.00000" height="1304.9023" width="8" x="442.6396" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="445.9331" x2="445.9331" y1="123.2422" y2="1428.1445"/></g><g><title>AppointmentQueryRepository</title><rect fill="#000000" fill-opacity="0.00000" height="1304.9023" width="8" x="805.0493" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="808.2256" x2="808.2256" y1="123.2422" y2="1428.1445"/></g><g><title>AppointmentRepository</title><rect fill="#000000" fill-opacity="0.00000" height="1304.9023" width="8" x="993.6348" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="996.873" x2="996.873" y1="123.2422" y2="1428.1445"/></g><g><title>AppointmentMapper</title><rect fill="#000000" fill-opacity="0.00000" height="1304.9023" width="8" x="1153.4341" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1157.3965" x2="1157.3965" y1="123.2422" y2="1428.1445"/></g><g><title>ExternalServiceClient</title><rect fill="#000000" fill-opacity="0.00000" height="1304.9023" width="8" x="1307.3887" y="123.2422"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1310.4717" x2="1310.4717" y1="123.2422" y2="1428.1445"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="5" y="119.7285">Client</text><ellipse cx="25.8965" cy="53.1211" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M25.8965,61.1211 L25.8965,88.1211 M12.8965,69.1211 L38.8965,69.1211 M25.8965,88.1211 L12.8965,103.1211 M25.8965,88.1211 L38.8965,103.1211" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35.793" x="5" y="1442.252">Client</text><ellipse cx="25.8965" cy="1454.2656" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M25.8965,1462.2656 L25.8965,1489.2656 M12.8965,1470.2656 L38.8965,1470.2656 M25.8965,1489.2656 L12.8965,1504.2656 M25.8965,1489.2656 L38.8965,1504.2656" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Controller"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.2959" x="161.4556" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.2959" x="168.4556" y="111.7285">AppointmentController</text></g><g class="participant participant-tail" data-participant="Controller"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.2959" x="161.4556" y="1427.1445"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.2959" x="168.4556" y="1449.252">AppointmentController</text></g><g class="participant participant-head" data-participant="QueryService"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177.4131" x="357.9331" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163.4131" x="364.9331" y="111.7285">AppointmentQueryService</text></g><g class="participant participant-tail" data-participant="QueryService"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177.4131" x="357.9331" y="1427.1445"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163.4131" x="364.9331" y="1449.252">AppointmentQueryService</text></g><g class="participant participant-head" data-participant="ReadRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197.6475" x="710.2256" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.6475" x="717.2256" y="93.1074">AppointmentQueryRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.5098" x="729.2944" y="111.7285">(Read Model - MongoDB)</text></g><g class="participant participant-tail" data-participant="ReadRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197.6475" x="710.2256" y="1427.1445"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183.6475" x="717.2256" y="1449.252">AppointmentQueryRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.5098" x="729.2944" y="1467.873">(Read Model - MongoDB)</text></g><g class="participant participant-head" data-participant="WriteRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="159.5234" x="917.873" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145.5234" x="924.873" y="93.1074">AppointmentRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.3447" x="940.4624" y="111.7285">(Write Model - H2)</text></g><g class="participant participant-tail" data-participant="WriteRepo"><rect fill="#E2E2F0" height="51.2422" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="159.5234" x="917.873" y="1427.1445"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145.5234" x="924.873" y="1449.252">AppointmentRepository</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.3447" x="940.4624" y="1467.873">(Write Model - H2)</text></g><g class="participant participant-head" data-participant="Mapper"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140.0752" x="1087.3965" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.0752" x="1094.3965" y="111.7285">AppointmentMapper</text></g><g class="participant participant-tail" data-participant="Mapper"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140.0752" x="1087.3965" y="1427.1445"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.0752" x="1094.3965" y="1449.252">AppointmentMapper</text></g><g class="participant participant-head" data-participant="ExternalClient"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.834" x="1237.4717" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.834" x="1244.4717" y="111.7285">ExternalServiceClient</text></g><g class="participant participant-tail" data-participant="ExternalClient"><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="147.834" x="1237.4717" y="1427.1445"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133.834" x="1244.4717" y="1449.252">ExternalServiceClient</text></g><g><title>Client</title><rect fill="#FFFFFF" height="1098.5742" style="stroke:#181818;stroke-width:1;" width="10" x="20.8965" y="133.2422"/></g><g><title>AppointmentController</title><rect fill="#FFFFFF" height="1075.2832" style="stroke:#181818;stroke-width:1;" width="10" x="233.1035" y="156.5332"/></g><g><title>AppointmentQueryService</title><rect fill="#FFFFFF" height="1003.4102" style="stroke:#181818;stroke-width:1;" width="10" x="441.6396" y="187.8242"/></g><g><title>AppointmentQueryRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="804.0493" y="219.1152"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="992.6348" y="422.8613"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="992.6348" y="644.8984"/></g><g><title>AppointmentRepository</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="992.6348" y="962.4883"/></g><g><title>AppointmentMapper</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1152.4341" y="851.9844"/></g><g><title>AppointmentMapper</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1152.4341" y="1113.6523"/></g><g><title>ExternalServiceClient</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1306.3887" y="582.3164"/></g><g><title>ExternalServiceClient</title><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1;" width="10" x="1306.3887" y="775.4023"/></g><g class="message" data-participant-1="Client" data-participant-2="Controller"><polygon fill="#181818" points="221.1035,152.5332,231.1035,156.5332,221.1035,160.5332,225.1035,156.5332" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="30.8965" x2="227.1035" y1="156.5332" y2="156.5332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="40.3965" y="151.2705">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.9771" x="51.6265" y="151.2705">GET /appointments/upcoming</text></g><g class="message" data-participant-1="Controller" data-participant-2="QueryService"><polygon fill="#181818" points="429.6396,183.8242,439.6396,187.8242,429.6396,191.8242,433.6396,187.8242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="243.1035" x2="435.6396" y1="187.8242" y2="187.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="255.4749" y="182.5615">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.5635" x="266.7048" y="182.5615">listUpcomingAppointments()</text></g><g class="message" data-participant-1="QueryService" data-participant-2="ReadRepo"><polygon fill="#181818" points="792.0493,215.1152,802.0493,219.1152,792.0493,223.1152,796.0493,219.1152" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="798.0493" y1="219.1152" y2="219.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="478.4709" y="213.8525">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287.5171" x="489.7009" y="213.8525">findByDateTimeAfterOrderByDateTimeAsc(now())</text></g><g class="message" data-participant-1="ReadRepo" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,246.4063,452.6396,250.4063,462.6396,254.4063,458.6396,250.4063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="808.0493" y1="250.4063" y2="250.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="542.7178" y="245.1436">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.0234" x="553.9478" y="245.1436">List&lt;AppointmentSummary&gt;</text></g><g class="message" data-participant-1="QueryService" data-participant-2="QueryService"><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="493.6396" y1="281.6973" y2="281.6973"/><line style="stroke:#181818;stroke-width:2;" x1="493.6396" x2="493.6396" y1="281.6973" y2="294.6973"/><line style="stroke:#181818;stroke-width:2;" x1="452.6396" x2="493.6396" y1="294.6973" y2="294.6973"/><polygon fill="#181818" points="462.6396,290.6973,452.6396,294.6973,462.6396,298.6973,458.6396,294.6973" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="458.6396" y="276.4346">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.7539" x="469.8696" y="276.4346">Filter by status = "SCHEDULED"</text></g><path d="M151.4556,309.6973 L211.6265,309.6973 L211.6265,318.9883 L201.6265,328.9883 L151.4556,328.9883 L151.4556,309.6973" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="874.5371" style="stroke:#000000;stroke-width:1.5;" width="1273.8501" x="151.4556" y="309.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="166.4556" y="324.7256">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="168.0454" x="226.6265" y="323.5674">[Summaries found in MongoDB]</text><g class="message" data-participant-1="QueryService" data-participant-2="QueryService"><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="493.6396" y1="352.2793" y2="352.2793"/><line style="stroke:#181818;stroke-width:2;" x1="493.6396" x2="493.6396" y1="352.2793" y2="365.2793"/><line style="stroke:#181818;stroke-width:2;" x1="452.6396" x2="493.6396" y1="365.2793" y2="365.2793"/><polygon fill="#181818" points="462.6396,361.2793,452.6396,365.2793,462.6396,369.2793,458.6396,365.2793" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="458.6396" y="347.0166">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.0234" x="469.8696" y="347.0166">Map summaries to Appointments</text></g><path d="M327.9331,380.2793 L400.3677,380.2793 L400.3677,389.5703 L390.3677,399.5703 L327.9331,399.5703 L327.9331,380.2793" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="441.4141" style="stroke:#000000;stroke-width:1.5;" width="1087.3726" x="327.9331" y="380.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27.4346" x="342.9331" y="395.3076">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174.1846" x="415.3677" y="394.1494">[For each AppointmentSummary]</text><g class="message" data-participant-1="QueryService" data-participant-2="WriteRepo"><polygon fill="#181818" points="980.6348,418.8613,990.6348,422.8613,980.6348,426.8613,984.6348,422.8613" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="986.6348" y1="422.8613" y2="422.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="647.5105" y="417.5986">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.0234" x="658.7405" y="417.5986">findById(appointmentId)</text></g><g class="message" data-participant-1="WriteRepo" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,450.1523,452.6396,454.1523,462.6396,458.1523,458.6396,454.1523" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="996.6348" y1="454.1523" y2="454.1523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="650.7246" y="448.8896">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.5952" x="661.9546" y="448.8896">Optional&lt;Appointment&gt;</text></g><path d="M337.9331,469.1523 L398.104,469.1523 L398.104,478.4434 L388.104,488.4434 L337.9331,488.4434 L337.9331,469.1523" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="345.541" style="stroke:#000000;stroke-width:1.5;" width="1067.3726" x="337.9331" y="469.1523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="352.9331" y="484.1807">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="131.3501" x="413.104" y="483.0225">[Full Appointment found]</text><g class="message" data-participant-1="QueryService" data-participant-2="QueryService"><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="493.6396" y1="511.7344" y2="511.7344"/><line style="stroke:#181818;stroke-width:2;" x1="493.6396" x2="493.6396" y1="511.7344" y2="524.7344"/><line style="stroke:#181818;stroke-width:2;" x1="452.6396" x2="493.6396" y1="524.7344" y2="524.7344"/><polygon fill="#181818" points="462.6396,520.7344,452.6396,524.7344,462.6396,528.7344,458.6396,524.7344" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7.23" x="458.6396" y="506.4717">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.1943" x="469.8696" y="506.4717">Check if patient data is missing</text></g><path d="M347.9331,539.7344 L408.104,539.7344 L408.104,549.0254 L398.104,559.0254 L347.9331,559.0254 L347.9331,539.7344" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="144.4551" style="stroke:#000000;stroke-width:1.5;" width="1047.3726" x="347.9331" y="539.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="362.9331" y="554.7627">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="114.2969" x="423.104" y="553.6045">[Patient data missing]</text><g class="message" data-participant-1="QueryService" data-participant-2="ExternalClient"><polygon fill="#181818" points="1294.3887,578.3164,1304.3887,582.3164,1294.3887,586.3164,1298.3887,582.3164" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="1300.3887" y1="582.3164" y2="582.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="798.2397" y="577.0537">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.0889" x="816.6997" y="577.0537">getPatientById(patientId)</text></g><g class="message" data-participant-1="ExternalClient" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,609.6074,452.6396,613.6074,462.6396,617.6074,458.6396,613.6074" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="1310.3887" y1="613.6074" y2="613.6074"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="837.5911" y="608.3447">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69.3862" x="856.051" y="608.3447">Patient data</text></g><g class="message" data-participant-1="QueryService" data-participant-2="WriteRepo"><polygon fill="#181818" points="980.6348,640.8984,990.6348,644.8984,980.6348,648.8984,984.6348,644.8984" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="986.6348" y1="644.8984" y2="644.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="632.3333" y="639.6357">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.1479" x="650.7932" y="639.6357">save(enriched appointment)</text></g><g class="message" data-participant-1="WriteRepo" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,672.1895,452.6396,676.1895,462.6396,680.1895,458.6396,676.1895" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="996.6348" y1="676.1895" y2="676.1895"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="696.9768" y="670.9268">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36.8608" x="715.4368" y="670.9268">Saved</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="337.9331" x2="1405.3057" y1="692.1895" y2="692.1895"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="172.3154" x="342.9331" y="704.0596">[Appointment not in write model]</text><g class="message" data-participant-1="QueryService" data-participant-2="QueryService"><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="493.6396" y1="731.1113" y2="731.1113"/><line style="stroke:#181818;stroke-width:2;" x1="493.6396" x2="493.6396" y1="731.1113" y2="744.1113"/><line style="stroke:#181818;stroke-width:2;" x1="452.6396" x2="493.6396" y1="744.1113" y2="744.1113"/><polygon fill="#181818" points="462.6396,740.1113,452.6396,744.1113,462.6396,748.1113,458.6396,744.1113" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="458.6396" y="725.8486">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.1816" x="477.0996" y="725.8486">Build Appointment from summary</text></g><g class="message" data-participant-1="QueryService" data-participant-2="ExternalClient"><polygon fill="#181818" points="1294.3887,771.4023,1304.3887,775.4023,1294.3887,779.4023,1298.3887,775.4023" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="1300.3887" y1="775.4023" y2="775.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="798.2397" y="770.1396">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.0889" x="816.6997" y="770.1396">getPatientById(patientId)</text></g><g class="message" data-participant-1="ExternalClient" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,802.6934,452.6396,806.6934,462.6396,810.6934,458.6396,806.6934" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="1310.3887" y1="806.6934" y2="806.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="837.5911" y="801.4307">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69.3862" x="856.051" y="801.4307">Patient data</text></g><g class="message" data-participant-1="QueryService" data-participant-2="Mapper"><polygon fill="#181818" points="1140.4341,847.9844,1150.4341,851.9844,1140.4341,855.9844,1144.4341,851.9844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="1146.4341" y1="851.9844" y2="851.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="720.196" y="846.7217">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.2217" x="738.656" y="846.7217">toListDTO(appointments)</text></g><g class="message" data-participant-1="Mapper" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,879.2754,452.6396,883.2754,462.6396,887.2754,458.6396,883.2754" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="1156.4341" y1="883.2754" y2="883.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="717.2688" y="878.0127">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0762" x="735.7288" y="878.0127">List&lt;AppointmentListDTO&gt;</text></g><g class="message" data-participant-1="QueryService" data-participant-2="Controller"><polygon fill="#181818" points="254.1035,910.5664,244.1035,914.5664,254.1035,918.5664,250.1035,914.5664" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="248.1035" x2="440.6396" y1="914.5664" y2="914.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="255.1035" y="909.3037">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0762" x="273.5635" y="909.3037">List&lt;AppointmentListDTO&gt;</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="151.4556" x2="1425.3057" y1="923.5664" y2="923.5664"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="169.8984" x="156.4556" y="935.4365">[Summaries not found or empty]</text><g class="message" data-participant-1="QueryService" data-participant-2="WriteRepo"><polygon fill="#181818" points="980.6348,958.4883,990.6348,962.4883,980.6348,966.4883,984.6348,962.4883" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="986.6348" y1="962.4883" y2="962.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="690.8745" y="957.2256">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.0654" x="709.3345" y="957.2256">findAll()</text></g><g class="message" data-participant-1="WriteRepo" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,989.7793,452.6396,993.7793,462.6396,997.7793,458.6396,993.7793" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="996.6348" y1="993.7793" y2="993.7793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="661.2046" y="988.5166">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.4053" x="679.6646" y="988.5166">List&lt;Appointment&gt;</text></g><g class="message" data-participant-1="QueryService" data-participant-2="QueryService"><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="493.6396" y1="1025.0703" y2="1025.0703"/><line style="stroke:#181818;stroke-width:2;" x1="493.6396" x2="493.6396" y1="1025.0703" y2="1038.0703"/><line style="stroke:#181818;stroke-width:2;" x1="452.6396" x2="493.6396" y1="1038.0703" y2="1038.0703"/><polygon fill="#181818" points="462.6396,1034.0703,452.6396,1038.0703,462.6396,1042.0703,458.6396,1038.0703" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="458.6396" y="1019.8076">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309.9497" x="477.0996" y="1019.8076">Filter by dateTime &gt; now() and status = SCHEDULED</text></g><g class="message" data-participant-1="QueryService" data-participant-2="QueryService"><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="493.6396" y1="1069.3613" y2="1069.3613"/><line style="stroke:#181818;stroke-width:2;" x1="493.6396" x2="493.6396" y1="1069.3613" y2="1082.3613"/><line style="stroke:#181818;stroke-width:2;" x1="452.6396" x2="493.6396" y1="1082.3613" y2="1082.3613"/><polygon fill="#181818" points="462.6396,1078.3613,452.6396,1082.3613,462.6396,1086.3613,458.6396,1082.3613" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="458.6396" y="1064.0986">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.8652" x="477.0996" y="1064.0986">Sort by dateTime ascending</text></g><g class="message" data-participant-1="QueryService" data-participant-2="Mapper"><polygon fill="#181818" points="1140.4341,1109.6523,1150.4341,1113.6523,1140.4341,1117.6523,1144.4341,1113.6523" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;" x1="451.6396" x2="1146.4341" y1="1113.6523" y2="1113.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="691.292" y="1108.3896">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.0298" x="709.752" y="1108.3896">toListDTO(upcomingAppointments)</text></g><g class="message" data-participant-1="Mapper" data-participant-2="QueryService"><polygon fill="#181818" points="462.6396,1140.9434,452.6396,1144.9434,462.6396,1148.9434,458.6396,1144.9434" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="456.6396" x2="1156.4341" y1="1144.9434" y2="1144.9434"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="717.2688" y="1139.6807">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0762" x="735.7288" y="1139.6807">List&lt;AppointmentListDTO&gt;</text></g><g class="message" data-participant-1="QueryService" data-participant-2="Controller"><polygon fill="#181818" points="254.1035,1172.2344,244.1035,1176.2344,254.1035,1180.2344,250.1035,1176.2344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="248.1035" x2="440.6396" y1="1176.2344" y2="1176.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="255.1035" y="1170.9717">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0762" x="273.5635" y="1170.9717">List&lt;AppointmentListDTO&gt;</text></g><g class="message" data-participant-1="Controller" data-participant-2="Client"><polygon fill="#181818" points="36.8965,1227.8164,26.8965,1231.8164,36.8965,1235.8164,32.8965,1231.8164" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:2;stroke-dasharray:2,2;" x1="30.8965" x2="237.1035" y1="1231.8164" y2="1231.8164"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14.46" x="44.7319" y="1217.9082">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.0845" x="119.1877" y="1209.2627">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0762" x="63.1919" y="1226.5537">List&lt;AppointmentListDTO&gt;</text></g><path d="M451,1244.8164 L451,1305.8164 L688,1305.8164 L688,1254.8164 L678,1244.8164 L451,1244.8164" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M678,1244.8164 L678,1254.8164 L688,1254.8164 L678,1244.8164" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.8735" x="457" y="1263.8447">Fallback strategy:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.8462" x="457" y="1281.1357">1. Try MongoDB read model first</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216.7534" x="457" y="1298.4268">2. If empty, fallback to H2 write model</text><path d="M243,1316.6895 L243,1412.6895 L588,1412.6895 L588,1326.6895 L578,1316.6895 L243,1316.6895" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M578,1316.6895 L578,1326.6895 L588,1326.6895 L578,1316.6895" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313.5933" x="249" y="1335.7178">Este diagrama mostra a listagem de consultas futuras.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315.7578" x="249" y="1353.0088">Primeiro busca no read model (MongoDB) filtrando por</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324.4287" x="249" y="1370.2998">status SCHEDULED e data futura. Se vazio, faz fallback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.4541" x="249" y="1387.5908">para o write model (H2). Enriquece dados do paciente</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113.4707" x="249" y="1404.8818">quando necess&#225;rio.</text><!--SRC=[pLTBSzCm4BxxL-oKYpj30-IOWSwaUT0ExRGqALoug9RYQ2fBHf9Rt7_3R-6FiV9JTXuD30TyYIFjVllGfzsrUU0o9PeaS4-YXrYhJDA94ah3gtdn1AQHCEnxncJ4hfWn96PZmMC94PEMwIrIOwtLqtBDemU9yZ0C0ikjOF25ioUOPpRJ3CPfghYq2M8OE855fGfJJcB42W8IMNHb8ZXA18XlUSHJ8YqSUQeJ9QrMGZ1z1CH0-tUdnkUCwNp1z2EFMA7ZB-pNkcMfCXozoh_9y9OH2bUACe7UNoaPg-dPSG7eTfpeJh0EpbVDBMk0peSbHh6w5-IAf6aLTVdQbPpzmAEHH5I1bMaifEkTAhC1oQoIMNAF29Xo_aZGdMgl_86JKo-n8_WuMy8RuXtVcooDLC9bx06q1n6qxmx9J_S813VshjBs6H4UjrYT0mhyVmwlplO8LbpIitoAAakUiF4AmxpMb6blpKIXL4_XiOVUd5Rz0YSRNbwYb-yzznPPaX2TdmQKRU9iUDZ5cdE1Zi5z3iOIcndu04UBoVbiUdSvcnxXSGWB9Jvd1bRkKWANDSC2m6U_0MG3c0R0givDA_I5KYdCyNAXzslOZAiGscQeOMMTx0iQUaIueCUDQfENbidrLhEo9TFNgUKAoUbd-xJHzDBTmhOcCNFpJ0W_eZA1ZSZBsPkiMVG0V0KfiGNvAR44k8646-Ceti5o9czymLeAUa_VQFSIZY1cji8fabePznEwaTZUFUxBTRUtfDhtUqFRotI_NhmKcaSIGnvPoAJcqPfHy9Yo9wnDlXp2cmLQelkYs0xBF6umOJfT2QIoxkOz5GKwSGNw3tXqbd51kqpKAgakPXxyUsuSmek_vyHkFlHJwNwtLgcoIusm8hboEbrU-wN3bC4qHggMvjRArmEgSWLRbWlFuGfhYrEznhOJiA16MvGTCSh2x6feajeyEA1QZeK8Ur5sIRcFtttNDeBirSD3Un2jEYESGj4OWM1KJMDg-j81c0kbRGUH69mFQLCoNwP3jcKE-BzfuQZk8NO75N_iSOZLRHw-VGlNdxx9dQWUe3T5-QjL8KOQCj0yNbjGgwvnW3aHmetrU9WQbU9yX8ll1h3KUJrBW7OZR57OaA3QkBiy7C35gkJqQrZL63X4d0yxXH13TzU0zRtmFCPoOt2BblCyjaRbN05Ip7pu3P7WOK2afCc4nR5qvJuBY1cWter6_d2ju3up4K4xlgTXFMkZpm819LMGAcUkecr3Mc1bJowH1_Y90O_acIiNs7CJ72gwZnTGVdmGuY0-W1csBlmiYHmGLGQSAHAvxBiKVyyAunBtZVdrKtCrQFFo6m00]--></g></svg>
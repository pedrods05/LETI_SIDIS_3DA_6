@startuml
title US09 - SD - Search Patient by Name
autoactivate on
autonumber

actor "Administrator"
participant ":controller:PatientController" as PatientController
participant ":helper:AuthHelper" as AuthHelper
participant ":service:PatientService" as PatientService
participant ":repo:PatientRepository" as PatientRepository
participant ":mapper:PatientMapper" as PatientMapper

activate Administrator

Administrator -> PatientController : GET /api/patients/search/by-name?name=
PatientController -> AuthHelper : getCurrentUser()
AuthHelper --> PatientController : User (role)
    PatientService -> PatientMapper : toDTOList(patients)
    PatientMapper --> PatientService : List<PatientDTO>

    PatientService --> PatientController : List<PatientDTO>
    PatientController --> Administrator : 200 OK

alt list is empty
  PatientController -> PatientService : searchPatientsByName(name)

  PatientService -> PatientRepository : findByNameContainingIgnoreCase(name)
  PatientRepository --> PatientService : List<Patient>
    PatientService --> PatientController : 404 Not Found
    PatientController --> Administrator : 404 Not Found
    deactivate Administrator
  end
  alt user.role != ADMIN
    PatientController --> Administrator : 403 Forbidden
    deactivate Administrator
  else
end
@enduml

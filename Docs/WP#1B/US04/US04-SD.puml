@startuml
title US04 - SD - View Top 5 Physicians based on the number of appointments
autoactivate on
autonumber

actor "Administrator"
participant ":controller:PhysicianController" as PhysicianController
participant ":service:PhysicianService" as PhysicianService
participant ":repo:AppointmentRepository" as AppointmentRepository
participant ":mapper:PhysicianMapper" as PhysicianMapper

activate Administrator

Administrator -> PhysicianController : GET /api/physicians/top5?from=YYYY-MM-DD&to=YYYY-MM-DD
note right: @PreAuthorize("hasAuthority('ADMIN')")

PhysicianController -> PhysicianService : getTop5Physicians(from, to)

PhysicianService -> AppointmentRepository : countAppointmentsByPhysicianInPeriod(from, to)
AppointmentRepository --> PhysicianService : List<Object[]> (physicianId, appointmentCount)

PhysicianService -> PhysicianMapper : toTop5DtoList(results)
PhysicianMapper --> PhysicianService : List<TopPhysicianDto>

PhysicianService --> PhysicianController : List<TopPhysicianDto>
PhysicianController --> Administrator : 200 OK

deactivate Administrator
@enduml
